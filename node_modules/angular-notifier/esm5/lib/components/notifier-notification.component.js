/**
 * @fileoverview added by tsickle
 * Generated from: lib/components/notifier-notification.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, Output, Renderer2 } from '@angular/core';
import { NotifierNotification } from '../models/notifier-notification.model';
import { NotifierService } from '../services/notifier.service';
import { NotifierAnimationService } from '../services/notifier-animation.service';
import { NotifierTimerService } from '../services/notifier-timer.service';
/**
 * Notifier notification component
 * -------------------------------
 * This component is responsible for actually displaying the notification on screen. In addition, it's able to show and hide this
 * notification, in particular to animate this notification in and out, as well as shift (move) this notification vertically around.
 * Furthermore, the notification component handles all interactions the user has with this notification / component, such as clicks and
 * mouse movements.
 */
var NotifierNotificationComponent = /** @class */ (function () {
    /**
     * Constructor
     *
     * @param elementRef               Reference to the component's element
     * @param renderer                 Angular renderer
     * @param notifierService          Notifier service
     * @param notifierTimerService     Notifier timer service
     * @param notifierAnimationService Notifier animation service
     */
    function NotifierNotificationComponent(elementRef, renderer, notifierService, notifierTimerService, notifierAnimationService) {
        this.config = notifierService.getConfig();
        this.ready = new EventEmitter();
        this.dismiss = new EventEmitter();
        this.timerService = notifierTimerService;
        this.animationService = notifierAnimationService;
        this.renderer = renderer;
        this.element = elementRef.nativeElement;
        this.elementShift = 0;
    }
    /**
     * Component after view init lifecycle hook, setts up the component and then emits the ready event
     */
    /**
     * Component after view init lifecycle hook, setts up the component and then emits the ready event
     * @return {?}
     */
    NotifierNotificationComponent.prototype.ngAfterViewInit = /**
     * Component after view init lifecycle hook, setts up the component and then emits the ready event
     * @return {?}
     */
    function () {
        this.setup();
        this.elementHeight = this.element.offsetHeight;
        this.elementWidth = this.element.offsetWidth;
        this.ready.emit(this);
    };
    /**
     * Get the notifier config
     *
     * @returns Notifier configuration
     */
    /**
     * Get the notifier config
     *
     * @return {?} Notifier configuration
     */
    NotifierNotificationComponent.prototype.getConfig = /**
     * Get the notifier config
     *
     * @return {?} Notifier configuration
     */
    function () {
        return this.config;
    };
    /**
     * Get notification element height (in px)
     *
     * @returns Notification element height (in px)
     */
    /**
     * Get notification element height (in px)
     *
     * @return {?} Notification element height (in px)
     */
    NotifierNotificationComponent.prototype.getHeight = /**
     * Get notification element height (in px)
     *
     * @return {?} Notification element height (in px)
     */
    function () {
        return this.elementHeight;
    };
    /**
     * Get notification element width (in px)
     *
     * @returns Notification element height (in px)
     */
    /**
     * Get notification element width (in px)
     *
     * @return {?} Notification element height (in px)
     */
    NotifierNotificationComponent.prototype.getWidth = /**
     * Get notification element width (in px)
     *
     * @return {?} Notification element height (in px)
     */
    function () {
        return this.elementWidth;
    };
    /**
     * Get notification shift offset (in px)
     *
     * @returns Notification element shift offset (in px)
     */
    /**
     * Get notification shift offset (in px)
     *
     * @return {?} Notification element shift offset (in px)
     */
    NotifierNotificationComponent.prototype.getShift = /**
     * Get notification shift offset (in px)
     *
     * @return {?} Notification element shift offset (in px)
     */
    function () {
        return this.elementShift;
    };
    /**
     * Show (animate in) this notification
     *
     * @returns Promise, resolved when done
     */
    /**
     * Show (animate in) this notification
     *
     * @return {?} Promise, resolved when done
     */
    NotifierNotificationComponent.prototype.show = /**
     * Show (animate in) this notification
     *
     * @return {?} Promise, resolved when done
     */
    function () {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            // Are animations enabled?
            if (_this.config.animations.enabled && _this.config.animations.show.speed > 0) {
                // Get animation data
                /** @type {?} */
                var animationData = _this.animationService.getAnimationData('show', _this.notification);
                // Set initial styles (styles before animation), prevents quick flicker when animation starts
                /** @type {?} */
                var animatedProperties = Object.keys(animationData.keyframes[0]);
                for (var i = animatedProperties.length - 1; i >= 0; i--) {
                    _this.renderer.setStyle(_this.element, animatedProperties[i], animationData.keyframes[0][animatedProperties[i]]);
                }
                // Animate notification in
                _this.renderer.setStyle(_this.element, 'visibility', 'visible');
                /** @type {?} */
                var animation = _this.element.animate(animationData.keyframes, animationData.options);
                animation.onfinish = (/**
                 * @return {?}
                 */
                function () {
                    _this.startAutoHideTimer();
                    resolve(); // Done
                });
            }
            else {
                // Show notification
                _this.renderer.setStyle(_this.element, 'visibility', 'visible');
                _this.startAutoHideTimer();
                resolve(); // Done
            }
        }));
    };
    /**
     * Hide (animate out) this notification
     *
     * @returns Promise, resolved when done
     */
    /**
     * Hide (animate out) this notification
     *
     * @return {?} Promise, resolved when done
     */
    NotifierNotificationComponent.prototype.hide = /**
     * Hide (animate out) this notification
     *
     * @return {?} Promise, resolved when done
     */
    function () {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            _this.stopAutoHideTimer();
            // Are animations enabled?
            if (_this.config.animations.enabled && _this.config.animations.hide.speed > 0) {
                /** @type {?} */
                var animationData = _this.animationService.getAnimationData('hide', _this.notification);
                /** @type {?} */
                var animation = _this.element.animate(animationData.keyframes, animationData.options);
                animation.onfinish = (/**
                 * @return {?}
                 */
                function () {
                    resolve(); // Done
                });
            }
            else {
                resolve(); // Done
            }
        }));
    };
    /**
     * Shift (move) this notification
     *
     * @param   distance         Distance to shift (in px)
     * @param   shiftToMakePlace Flag, defining in which direction to shift
     * @returns Promise, resolved when done
     */
    /**
     * Shift (move) this notification
     *
     * @param {?} distance         Distance to shift (in px)
     * @param {?} shiftToMakePlace Flag, defining in which direction to shift
     * @return {?} Promise, resolved when done
     */
    NotifierNotificationComponent.prototype.shift = /**
     * Shift (move) this notification
     *
     * @param {?} distance         Distance to shift (in px)
     * @param {?} shiftToMakePlace Flag, defining in which direction to shift
     * @return {?} Promise, resolved when done
     */
    function (distance, shiftToMakePlace) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            // Calculate new position (position after the shift)
            /** @type {?} */
            var newElementShift;
            if ((_this.config.position.vertical.position === 'top' && shiftToMakePlace) ||
                (_this.config.position.vertical.position === 'bottom' && !shiftToMakePlace)) {
                newElementShift = _this.elementShift + distance + _this.config.position.vertical.gap;
            }
            else {
                newElementShift = _this.elementShift - distance - _this.config.position.vertical.gap;
            }
            /** @type {?} */
            var horizontalPosition = _this.config.position.horizontal.position === 'middle' ? '-50%' : '0';
            // Are animations enabled?
            if (_this.config.animations.enabled && _this.config.animations.shift.speed > 0) {
                /** @type {?} */
                var animationData = {
                    // TODO: Extract into animation service
                    keyframes: [
                        {
                            transform: "translate3d( " + horizontalPosition + ", " + _this.elementShift + "px, 0 )",
                        },
                        {
                            transform: "translate3d( " + horizontalPosition + ", " + newElementShift + "px, 0 )",
                        },
                    ],
                    options: {
                        duration: _this.config.animations.shift.speed,
                        easing: _this.config.animations.shift.easing,
                        fill: 'forwards',
                    },
                };
                _this.elementShift = newElementShift;
                /** @type {?} */
                var animation = _this.element.animate(animationData.keyframes, animationData.options);
                animation.onfinish = (/**
                 * @return {?}
                 */
                function () {
                    resolve(); // Done
                });
            }
            else {
                _this.renderer.setStyle(_this.element, 'transform', "translate3d( " + horizontalPosition + ", " + newElementShift + "px, 0 )");
                _this.elementShift = newElementShift;
                resolve(); // Done
            }
        }));
    };
    /**
     * Handle click on dismiss button
     */
    /**
     * Handle click on dismiss button
     * @return {?}
     */
    NotifierNotificationComponent.prototype.onClickDismiss = /**
     * Handle click on dismiss button
     * @return {?}
     */
    function () {
        this.dismiss.emit(this.notification.id);
    };
    /**
     * Handle mouseover over notification area
     */
    /**
     * Handle mouseover over notification area
     * @return {?}
     */
    NotifierNotificationComponent.prototype.onNotificationMouseover = /**
     * Handle mouseover over notification area
     * @return {?}
     */
    function () {
        if (this.config.behaviour.onMouseover === 'pauseAutoHide') {
            this.pauseAutoHideTimer();
        }
        else if (this.config.behaviour.onMouseover === 'resetAutoHide') {
            this.stopAutoHideTimer();
        }
    };
    /**
     * Handle mouseout from notification area
     */
    /**
     * Handle mouseout from notification area
     * @return {?}
     */
    NotifierNotificationComponent.prototype.onNotificationMouseout = /**
     * Handle mouseout from notification area
     * @return {?}
     */
    function () {
        if (this.config.behaviour.onMouseover === 'pauseAutoHide') {
            this.continueAutoHideTimer();
        }
        else if (this.config.behaviour.onMouseover === 'resetAutoHide') {
            this.startAutoHideTimer();
        }
    };
    /**
     * Handle click on notification area
     */
    /**
     * Handle click on notification area
     * @return {?}
     */
    NotifierNotificationComponent.prototype.onNotificationClick = /**
     * Handle click on notification area
     * @return {?}
     */
    function () {
        if (this.config.behaviour.onClick === 'hide') {
            this.onClickDismiss();
        }
    };
    /**
     * Start the auto hide timer (if enabled)
     */
    /**
     * Start the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    NotifierNotificationComponent.prototype.startAutoHideTimer = /**
     * Start the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.start(this.config.behaviour.autoHide).then((/**
             * @return {?}
             */
            function () {
                _this.onClickDismiss();
            }));
        }
    };
    /**
     * Pause the auto hide timer (if enabled)
     */
    /**
     * Pause the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    NotifierNotificationComponent.prototype.pauseAutoHideTimer = /**
     * Pause the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    function () {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.pause();
        }
    };
    /**
     * Continue the auto hide timer (if enabled)
     */
    /**
     * Continue the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    NotifierNotificationComponent.prototype.continueAutoHideTimer = /**
     * Continue the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    function () {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.continue();
        }
    };
    /**
     * Stop the auto hide timer (if enabled)
     */
    /**
     * Stop the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    NotifierNotificationComponent.prototype.stopAutoHideTimer = /**
     * Stop the auto hide timer (if enabled)
     * @private
     * @return {?}
     */
    function () {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.stop();
        }
    };
    /**
     * Initial notification setup
     */
    /**
     * Initial notification setup
     * @private
     * @return {?}
     */
    NotifierNotificationComponent.prototype.setup = /**
     * Initial notification setup
     * @private
     * @return {?}
     */
    function () {
        // Set start position (initially the exact same for every new notification)
        if (this.config.position.horizontal.position === 'left') {
            this.renderer.setStyle(this.element, 'left', this.config.position.horizontal.distance + "px");
        }
        else if (this.config.position.horizontal.position === 'right') {
            this.renderer.setStyle(this.element, 'right', this.config.position.horizontal.distance + "px");
        }
        else {
            this.renderer.setStyle(this.element, 'left', '50%');
            // Let's get the GPU handle some work as well (#perfmatters)
            this.renderer.setStyle(this.element, 'transform', 'translate3d( -50%, 0, 0 )');
        }
        if (this.config.position.vertical.position === 'top') {
            this.renderer.setStyle(this.element, 'top', this.config.position.vertical.distance + "px");
        }
        else {
            this.renderer.setStyle(this.element, 'bottom', this.config.position.vertical.distance + "px");
        }
        // Add classes (responsible for visual design)
        this.renderer.addClass(this.element, "notifier__notification--" + this.notification.type);
        this.renderer.addClass(this.element, "notifier__notification--" + this.config.theme);
    };
    NotifierNotificationComponent.decorators = [
        { type: Component, args: [{
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    // (#perfmatters)
                    host: {
                        '(click)': 'onNotificationClick()',
                        '(mouseout)': 'onNotificationMouseout()',
                        '(mouseover)': 'onNotificationMouseover()',
                        class: 'notifier__notification',
                    },
                    providers: [
                        // We provide the timer to the component's local injector, so that every notification components gets its own
                        // instance of the timer service, thus running their timers independently from each other
                        NotifierTimerService,
                    ],
                    selector: 'notifier-notification',
                    template: "<ng-container\n  *ngIf=\"notification.template; else predefinedNotification\"\n  [ngTemplateOutlet]=\"notification.template\"\n  [ngTemplateOutletContext]=\"{ notification: notification }\"\n>\n</ng-container>\n\n<ng-template #predefinedNotification>\n  <p class=\"notifier__notification-message\">{{ notification.message }}</p>\n  <button\n    class=\"notifier__notification-button\"\n    type=\"button\"\n    title=\"dismiss\"\n    *ngIf=\"config.behaviour.showDismissButton\"\n    (click)=\"onClickDismiss()\"\n  >\n    <svg class=\"notifier__notification-button-icon\" viewBox=\"0 0 24 24\" width=\"20\" height=\"20\">\n      <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" />\n    </svg>\n  </button>\n</ng-template>\n"
                }] }
    ];
    /** @nocollapse */
    NotifierNotificationComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: NotifierService },
        { type: NotifierTimerService },
        { type: NotifierAnimationService }
    ]; };
    NotifierNotificationComponent.propDecorators = {
        notification: [{ type: Input }],
        ready: [{ type: Output }],
        dismiss: [{ type: Output }]
    };
    return NotifierNotificationComponent;
}());
export { NotifierNotificationComponent };
if (false) {
    /**
     * Input: Notification object, contains all details necessary to construct the notification
     * @type {?}
     */
    NotifierNotificationComponent.prototype.notification;
    /**
     * Output: Ready event, handles the initialization success by emitting a reference to this notification component
     * @type {?}
     */
    NotifierNotificationComponent.prototype.ready;
    /**
     * Output: Dismiss event, handles the click on the dismiss button by emitting the notification ID of this notification component
     * @type {?}
     */
    NotifierNotificationComponent.prototype.dismiss;
    /**
     * Notifier configuration
     * @type {?}
     */
    NotifierNotificationComponent.prototype.config;
    /**
     * Notifier timer service
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.timerService;
    /**
     * Notifier animation service
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.animationService;
    /**
     * Angular renderer, used to preserve the overall DOM abstraction & independence
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.renderer;
    /**
     * Native element reference, used for manipulating DOM properties
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.element;
    /**
     * Current notification height, calculated and cached here (#perfmatters)
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.elementHeight;
    /**
     * Current notification width, calculated and cached here (#perfmatters)
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.elementWidth;
    /**
     * Current notification shift, calculated and cached here (#perfmatters)
     * @type {?}
     * @private
     */
    NotifierNotificationComponent.prototype.elementShift;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpZXItbm90aWZpY2F0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItbm90aWZpZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9ub3RpZmllci1ub3RpZmljYXRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFpQix1QkFBdUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUl0SSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0QsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDbEYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7Ozs7OztBQVUxRTtJQTJFRTs7Ozs7Ozs7T0FRRztJQUNILHVDQUNFLFVBQXNCLEVBQ3RCLFFBQW1CLEVBQ25CLGVBQWdDLEVBQ2hDLG9CQUEwQyxFQUMxQyx3QkFBa0Q7UUFFbEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxlQUFlLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLFlBQVksRUFBaUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFDMUMsSUFBSSxDQUFDLFlBQVksR0FBRyxvQkFBb0IsQ0FBQztRQUN6QyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsd0JBQXdCLENBQUM7UUFDakQsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsYUFBYSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FB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Q0FBdUM7Ozs7OztJQUt2QyxxREFBb0Q7Ozs7OztJQUtwRCx5REFBNEQ7Ozs7OztJQUs1RCxpREFBcUM7Ozs7OztJQUtyQyxnREFBc0M7Ozs7OztJQUt0QyxzREFBOEI7Ozs7OztJQUs5QixxREFBNkI7Ozs7OztJQUs3QixxREFBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBOb3RpZmllckFuaW1hdGlvbkRhdGEgfSBmcm9tICcuLi9tb2RlbHMvbm90aWZpZXItYW5pbWF0aW9uLm1vZGVsJztcbmltcG9ydCB7IE5vdGlmaWVyQ29uZmlnIH0gZnJvbSAnLi4vbW9kZWxzL25vdGlmaWVyLWNvbmZpZy5tb2RlbCc7XG5pbXBvcnQgeyBOb3RpZmllck5vdGlmaWNhdGlvbiB9IGZyb20gJy4uL21vZGVscy9ub3RpZmllci1ub3RpZmljYXRpb24ubW9kZWwnO1xuaW1wb3J0IHsgTm90aWZpZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbm90aWZpZXIuc2VydmljZSc7XG5pbXBvcnQgeyBOb3RpZmllckFuaW1hdGlvblNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9ub3RpZmllci1hbmltYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBOb3RpZmllclRpbWVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL25vdGlmaWVyLXRpbWVyLnNlcnZpY2UnO1xuXG4vKipcbiAqIE5vdGlmaWVyIG5vdGlmaWNhdGlvbiBjb21wb25lbnRcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgY29tcG9uZW50IGlzIHJlc3BvbnNpYmxlIGZvciBhY3R1YWxseSBkaXNwbGF5aW5nIHRoZSBub3RpZmljYXRpb24gb24gc2NyZWVuLiBJbiBhZGRpdGlvbiwgaXQncyBhYmxlIHRvIHNob3cgYW5kIGhpZGUgdGhpc1xuICogbm90aWZpY2F0aW9uLCBpbiBwYXJ0aWN1bGFyIHRvIGFuaW1hdGUgdGhpcyBub3RpZmljYXRpb24gaW4gYW5kIG91dCwgYXMgd2VsbCBhcyBzaGlmdCAobW92ZSkgdGhpcyBub3RpZmljYXRpb24gdmVydGljYWxseSBhcm91bmQuXG4gKiBGdXJ0aGVybW9yZSwgdGhlIG5vdGlmaWNhdGlvbiBjb21wb25lbnQgaGFuZGxlcyBhbGwgaW50ZXJhY3Rpb25zIHRoZSB1c2VyIGhhcyB3aXRoIHRoaXMgbm90aWZpY2F0aW9uIC8gY29tcG9uZW50LCBzdWNoIGFzIGNsaWNrcyBhbmRcbiAqIG1vdXNlIG1vdmVtZW50cy5cbiAqL1xuQENvbXBvbmVudCh7XG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLCAvLyAoI3BlcmZtYXR0ZXJzKVxuICBob3N0OiB7XG4gICAgJyhjbGljayknOiAnb25Ob3RpZmljYXRpb25DbGljaygpJyxcbiAgICAnKG1vdXNlb3V0KSc6ICdvbk5vdGlmaWNhdGlvbk1vdXNlb3V0KCknLFxuICAgICcobW91c2VvdmVyKSc6ICdvbk5vdGlmaWNhdGlvbk1vdXNlb3ZlcigpJyxcbiAgICBjbGFzczogJ25vdGlmaWVyX19ub3RpZmljYXRpb24nLFxuICB9LFxuICBwcm92aWRlcnM6IFtcbiAgICAvLyBXZSBwcm92aWRlIHRoZSB0aW1lciB0byB0aGUgY29tcG9uZW50J3MgbG9jYWwgaW5qZWN0b3IsIHNvIHRoYXQgZXZlcnkgbm90aWZpY2F0aW9uIGNvbXBvbmVudHMgZ2V0cyBpdHMgb3duXG4gICAgLy8gaW5zdGFuY2Ugb2YgdGhlIHRpbWVyIHNlcnZpY2UsIHRodXMgcnVubmluZyB0aGVpciB0aW1lcnMgaW5kZXBlbmRlbnRseSBmcm9tIGVhY2ggb3RoZXJcbiAgICBOb3RpZmllclRpbWVyU2VydmljZSxcbiAgXSxcbiAgc2VsZWN0b3I6ICdub3RpZmllci1ub3RpZmljYXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vbm90aWZpZXItbm90aWZpY2F0aW9uLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgTm90aWZpZXJOb3RpZmljYXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcbiAgLyoqXG4gICAqIElucHV0OiBOb3RpZmljYXRpb24gb2JqZWN0LCBjb250YWlucyBhbGwgZGV0YWlscyBuZWNlc3NhcnkgdG8gY29uc3RydWN0IHRoZSBub3RpZmljYXRpb25cbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBub3RpZmljYXRpb246IE5vdGlmaWVyTm90aWZpY2F0aW9uO1xuXG4gIC8qKlxuICAgKiBPdXRwdXQ6IFJlYWR5IGV2ZW50LCBoYW5kbGVzIHRoZSBpbml0aWFsaXphdGlvbiBzdWNjZXNzIGJ5IGVtaXR0aW5nIGEgcmVmZXJlbmNlIHRvIHRoaXMgbm90aWZpY2F0aW9uIGNvbXBvbmVudFxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyByZWFkeTogRXZlbnRFbWl0dGVyPE5vdGlmaWVyTm90aWZpY2F0aW9uQ29tcG9uZW50PjtcblxuICAvKipcbiAgICogT3V0cHV0OiBEaXNtaXNzIGV2ZW50LCBoYW5kbGVzIHRoZSBjbGljayBvbiB0aGUgZGlzbWlzcyBidXR0b24gYnkgZW1pdHRpbmcgdGhlIG5vdGlmaWNhdGlvbiBJRCBvZiB0aGlzIG5vdGlmaWNhdGlvbiBjb21wb25lbnRcbiAgICovXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgZGlzbWlzczogRXZlbnRFbWl0dGVyPHN0cmluZz47XG5cbiAgLyoqXG4gICAqIE5vdGlmaWVyIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb25maWc6IE5vdGlmaWVyQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBOb3RpZmllciB0aW1lciBzZXJ2aWNlXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IHRpbWVyU2VydmljZTogTm90aWZpZXJUaW1lclNlcnZpY2U7XG5cbiAgLyoqXG4gICAqIE5vdGlmaWVyIGFuaW1hdGlvbiBzZXJ2aWNlXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFuaW1hdGlvblNlcnZpY2U6IE5vdGlmaWVyQW5pbWF0aW9uU2VydmljZTtcblxuICAvKipcbiAgICogQW5ndWxhciByZW5kZXJlciwgdXNlZCB0byBwcmVzZXJ2ZSB0aGUgb3ZlcmFsbCBET00gYWJzdHJhY3Rpb24gJiBpbmRlcGVuZGVuY2VcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZXI6IFJlbmRlcmVyMjtcblxuICAvKipcbiAgICogTmF0aXZlIGVsZW1lbnQgcmVmZXJlbmNlLCB1c2VkIGZvciBtYW5pcHVsYXRpbmcgRE9NIHByb3BlcnRpZXNcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG5cbiAgLyoqXG4gICAqIEN1cnJlbnQgbm90aWZpY2F0aW9uIGhlaWdodCwgY2FsY3VsYXRlZCBhbmQgY2FjaGVkIGhlcmUgKCNwZXJmbWF0dGVycylcbiAgICovXG4gIHByaXZhdGUgZWxlbWVudEhlaWdodDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBDdXJyZW50IG5vdGlmaWNhdGlvbiB3aWR0aCwgY2FsY3VsYXRlZCBhbmQgY2FjaGVkIGhlcmUgKCNwZXJmbWF0dGVycylcbiAgICovXG4gIHByaXZhdGUgZWxlbWVudFdpZHRoOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEN1cnJlbnQgbm90aWZpY2F0aW9uIHNoaWZ0LCBjYWxjdWxhdGVkIGFuZCBjYWNoZWQgaGVyZSAoI3BlcmZtYXR0ZXJzKVxuICAgKi9cbiAgcHJpdmF0ZSBlbGVtZW50U2hpZnQ6IG51bWJlcjtcblxuICAvKipcbiAgICogQ29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRSZWYgICAgICAgICAgICAgICBSZWZlcmVuY2UgdG8gdGhlIGNvbXBvbmVudCdzIGVsZW1lbnRcbiAgICogQHBhcmFtIHJlbmRlcmVyICAgICAgICAgICAgICAgICBBbmd1bGFyIHJlbmRlcmVyXG4gICAqIEBwYXJhbSBub3RpZmllclNlcnZpY2UgICAgICAgICAgTm90aWZpZXIgc2VydmljZVxuICAgKiBAcGFyYW0gbm90aWZpZXJUaW1lclNlcnZpY2UgICAgIE5vdGlmaWVyIHRpbWVyIHNlcnZpY2VcbiAgICogQHBhcmFtIG5vdGlmaWVyQW5pbWF0aW9uU2VydmljZSBOb3RpZmllciBhbmltYXRpb24gc2VydmljZVxuICAgKi9cbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBub3RpZmllclNlcnZpY2U6IE5vdGlmaWVyU2VydmljZSxcbiAgICBub3RpZmllclRpbWVyU2VydmljZTogTm90aWZpZXJUaW1lclNlcnZpY2UsXG4gICAgbm90aWZpZXJBbmltYXRpb25TZXJ2aWNlOiBOb3RpZmllckFuaW1hdGlvblNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuY29uZmlnID0gbm90aWZpZXJTZXJ2aWNlLmdldENvbmZpZygpO1xuICAgIHRoaXMucmVhZHkgPSBuZXcgRXZlbnRFbWl0dGVyPE5vdGlmaWVyTm90aWZpY2F0aW9uQ29tcG9uZW50PigpO1xuICAgIHRoaXMuZGlzbWlzcyA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICAgIHRoaXMudGltZXJTZXJ2aWNlID0gbm90aWZpZXJUaW1lclNlcnZpY2U7XG4gICAgdGhpcy5hbmltYXRpb25TZXJ2aWNlID0gbm90aWZpZXJBbmltYXRpb25TZXJ2aWNlO1xuICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgdGhpcy5lbGVtZW50U2hpZnQgPSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBvbmVudCBhZnRlciB2aWV3IGluaXQgbGlmZWN5Y2xlIGhvb2ssIHNldHRzIHVwIHRoZSBjb21wb25lbnQgYW5kIHRoZW4gZW1pdHMgdGhlIHJlYWR5IGV2ZW50XG4gICAqL1xuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuc2V0dXAoKTtcbiAgICB0aGlzLmVsZW1lbnRIZWlnaHQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIHRoaXMuZWxlbWVudFdpZHRoID0gdGhpcy5lbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIHRoaXMucmVhZHkuZW1pdCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG5vdGlmaWVyIGNvbmZpZ1xuICAgKlxuICAgKiBAcmV0dXJucyBOb3RpZmllciBjb25maWd1cmF0aW9uXG4gICAqL1xuICBwdWJsaWMgZ2V0Q29uZmlnKCk6IE5vdGlmaWVyQ29uZmlnIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWc7XG4gIH1cblxuICAvKipcbiAgICogR2V0IG5vdGlmaWNhdGlvbiBlbGVtZW50IGhlaWdodCAoaW4gcHgpXG4gICAqXG4gICAqIEByZXR1cm5zIE5vdGlmaWNhdGlvbiBlbGVtZW50IGhlaWdodCAoaW4gcHgpXG4gICAqL1xuICBwdWJsaWMgZ2V0SGVpZ2h0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudEhlaWdodDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbm90aWZpY2F0aW9uIGVsZW1lbnQgd2lkdGggKGluIHB4KVxuICAgKlxuICAgKiBAcmV0dXJucyBOb3RpZmljYXRpb24gZWxlbWVudCBoZWlnaHQgKGluIHB4KVxuICAgKi9cbiAgcHVibGljIGdldFdpZHRoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudFdpZHRoO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBub3RpZmljYXRpb24gc2hpZnQgb2Zmc2V0IChpbiBweClcbiAgICpcbiAgICogQHJldHVybnMgTm90aWZpY2F0aW9uIGVsZW1lbnQgc2hpZnQgb2Zmc2V0IChpbiBweClcbiAgICovXG4gIHB1YmxpYyBnZXRTaGlmdCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRTaGlmdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IChhbmltYXRlIGluKSB0aGlzIG5vdGlmaWNhdGlvblxuICAgKlxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHB1YmxpYyBzaG93KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgLy8gQXJlIGFuaW1hdGlvbnMgZW5hYmxlZD9cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmltYXRpb25zLmVuYWJsZWQgJiYgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5zaG93LnNwZWVkID4gMCkge1xuICAgICAgICAvLyBHZXQgYW5pbWF0aW9uIGRhdGFcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRGF0YTogTm90aWZpZXJBbmltYXRpb25EYXRhID0gdGhpcy5hbmltYXRpb25TZXJ2aWNlLmdldEFuaW1hdGlvbkRhdGEoJ3Nob3cnLCB0aGlzLm5vdGlmaWNhdGlvbik7XG5cbiAgICAgICAgLy8gU2V0IGluaXRpYWwgc3R5bGVzIChzdHlsZXMgYmVmb3JlIGFuaW1hdGlvbiksIHByZXZlbnRzIHF1aWNrIGZsaWNrZXIgd2hlbiBhbmltYXRpb24gc3RhcnRzXG4gICAgICAgIGNvbnN0IGFuaW1hdGVkUHJvcGVydGllczogQXJyYXk8c3RyaW5nPiA9IE9iamVjdC5rZXlzKGFuaW1hdGlvbkRhdGEua2V5ZnJhbWVzWzBdKTtcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gYW5pbWF0ZWRQcm9wZXJ0aWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsIGFuaW1hdGVkUHJvcGVydGllc1tpXSwgYW5pbWF0aW9uRGF0YS5rZXlmcmFtZXNbMF1bYW5pbWF0ZWRQcm9wZXJ0aWVzW2ldXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbmltYXRlIG5vdGlmaWNhdGlvbiBpblxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbiA9IHRoaXMuZWxlbWVudC5hbmltYXRlKGFuaW1hdGlvbkRhdGEua2V5ZnJhbWVzLCBhbmltYXRpb25EYXRhLm9wdGlvbnMpO1xuICAgICAgICBhbmltYXRpb24ub25maW5pc2ggPSAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zdGFydEF1dG9IaWRlVGltZXIoKTtcbiAgICAgICAgICByZXNvbHZlKCk7IC8vIERvbmVcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNob3cgbm90aWZpY2F0aW9uXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgICAgIHRoaXMuc3RhcnRBdXRvSGlkZVRpbWVyKCk7XG4gICAgICAgIHJlc29sdmUoKTsgLy8gRG9uZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgKGFuaW1hdGUgb3V0KSB0aGlzIG5vdGlmaWNhdGlvblxuICAgKlxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHB1YmxpYyBoaWRlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgdGhpcy5zdG9wQXV0b0hpZGVUaW1lcigpO1xuXG4gICAgICAvLyBBcmUgYW5pbWF0aW9ucyBlbmFibGVkP1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuZW5hYmxlZCAmJiB0aGlzLmNvbmZpZy5hbmltYXRpb25zLmhpZGUuc3BlZWQgPiAwKSB7XG4gICAgICAgIGNvbnN0IGFuaW1hdGlvbkRhdGE6IE5vdGlmaWVyQW5pbWF0aW9uRGF0YSA9IHRoaXMuYW5pbWF0aW9uU2VydmljZS5nZXRBbmltYXRpb25EYXRhKCdoaWRlJywgdGhpcy5ub3RpZmljYXRpb24pO1xuICAgICAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbiA9IHRoaXMuZWxlbWVudC5hbmltYXRlKGFuaW1hdGlvbkRhdGEua2V5ZnJhbWVzLCBhbmltYXRpb25EYXRhLm9wdGlvbnMpO1xuICAgICAgICBhbmltYXRpb24ub25maW5pc2ggPSAoKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZSgpOyAvLyBEb25lXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNvbHZlKCk7IC8vIERvbmVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaGlmdCAobW92ZSkgdGhpcyBub3RpZmljYXRpb25cbiAgICpcbiAgICogQHBhcmFtICAgZGlzdGFuY2UgICAgICAgICBEaXN0YW5jZSB0byBzaGlmdCAoaW4gcHgpXG4gICAqIEBwYXJhbSAgIHNoaWZ0VG9NYWtlUGxhY2UgRmxhZywgZGVmaW5pbmcgaW4gd2hpY2ggZGlyZWN0aW9uIHRvIHNoaWZ0XG4gICAqIEByZXR1cm5zIFByb21pc2UsIHJlc29sdmVkIHdoZW4gZG9uZVxuICAgKi9cbiAgcHVibGljIHNoaWZ0KGRpc3RhbmNlOiBudW1iZXIsIHNoaWZ0VG9NYWtlUGxhY2U6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmU6ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIC8vIENhbGN1bGF0ZSBuZXcgcG9zaXRpb24gKHBvc2l0aW9uIGFmdGVyIHRoZSBzaGlmdClcbiAgICAgIGxldCBuZXdFbGVtZW50U2hpZnQ6IG51bWJlcjtcbiAgICAgIGlmIChcbiAgICAgICAgKHRoaXMuY29uZmlnLnBvc2l0aW9uLnZlcnRpY2FsLnBvc2l0aW9uID09PSAndG9wJyAmJiBzaGlmdFRvTWFrZVBsYWNlKSB8fFxuICAgICAgICAodGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwucG9zaXRpb24gPT09ICdib3R0b20nICYmICFzaGlmdFRvTWFrZVBsYWNlKVxuICAgICAgKSB7XG4gICAgICAgIG5ld0VsZW1lbnRTaGlmdCA9IHRoaXMuZWxlbWVudFNoaWZ0ICsgZGlzdGFuY2UgKyB0aGlzLmNvbmZpZy5wb3NpdGlvbi52ZXJ0aWNhbC5nYXA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdFbGVtZW50U2hpZnQgPSB0aGlzLmVsZW1lbnRTaGlmdCAtIGRpc3RhbmNlIC0gdGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwuZ2FwO1xuICAgICAgfVxuICAgICAgY29uc3QgaG9yaXpvbnRhbFBvc2l0aW9uOiBzdHJpbmcgPSB0aGlzLmNvbmZpZy5wb3NpdGlvbi5ob3Jpem9udGFsLnBvc2l0aW9uID09PSAnbWlkZGxlJyA/ICctNTAlJyA6ICcwJztcblxuICAgICAgLy8gQXJlIGFuaW1hdGlvbnMgZW5hYmxlZD9cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmltYXRpb25zLmVuYWJsZWQgJiYgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5zaGlmdC5zcGVlZCA+IDApIHtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRGF0YTogTm90aWZpZXJBbmltYXRpb25EYXRhID0ge1xuICAgICAgICAgIC8vIFRPRE86IEV4dHJhY3QgaW50byBhbmltYXRpb24gc2VydmljZVxuICAgICAgICAgIGtleWZyYW1lczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUzZCggJHtob3Jpem9udGFsUG9zaXRpb259LCAke3RoaXMuZWxlbWVudFNoaWZ0fXB4LCAwIClgLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlM2QoICR7aG9yaXpvbnRhbFBvc2l0aW9ufSwgJHtuZXdFbGVtZW50U2hpZnR9cHgsIDAgKWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgZHVyYXRpb246IHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuc2hpZnQuc3BlZWQsXG4gICAgICAgICAgICBlYXNpbmc6IHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuc2hpZnQuZWFzaW5nLFxuICAgICAgICAgICAgZmlsbDogJ2ZvcndhcmRzJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmVsZW1lbnRTaGlmdCA9IG5ld0VsZW1lbnRTaGlmdDtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uOiBBbmltYXRpb24gPSB0aGlzLmVsZW1lbnQuYW5pbWF0ZShhbmltYXRpb25EYXRhLmtleWZyYW1lcywgYW5pbWF0aW9uRGF0YS5vcHRpb25zKTtcbiAgICAgICAgYW5pbWF0aW9uLm9uZmluaXNoID0gKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoKTsgLy8gRG9uZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlM2QoICR7aG9yaXpvbnRhbFBvc2l0aW9ufSwgJHtuZXdFbGVtZW50U2hpZnR9cHgsIDAgKWApO1xuICAgICAgICB0aGlzLmVsZW1lbnRTaGlmdCA9IG5ld0VsZW1lbnRTaGlmdDtcbiAgICAgICAgcmVzb2x2ZSgpOyAvLyBEb25lXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGNsaWNrIG9uIGRpc21pc3MgYnV0dG9uXG4gICAqL1xuICBwdWJsaWMgb25DbGlja0Rpc21pc3MoKTogdm9pZCB7XG4gICAgdGhpcy5kaXNtaXNzLmVtaXQodGhpcy5ub3RpZmljYXRpb24uaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBtb3VzZW92ZXIgb3ZlciBub3RpZmljYXRpb24gYXJlYVxuICAgKi9cbiAgcHVibGljIG9uTm90aWZpY2F0aW9uTW91c2VvdmVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbmZpZy5iZWhhdmlvdXIub25Nb3VzZW92ZXIgPT09ICdwYXVzZUF1dG9IaWRlJykge1xuICAgICAgdGhpcy5wYXVzZUF1dG9IaWRlVGltZXIoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLmJlaGF2aW91ci5vbk1vdXNlb3ZlciA9PT0gJ3Jlc2V0QXV0b0hpZGUnKSB7XG4gICAgICB0aGlzLnN0b3BBdXRvSGlkZVRpbWVyKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBtb3VzZW91dCBmcm9tIG5vdGlmaWNhdGlvbiBhcmVhXG4gICAqL1xuICBwdWJsaWMgb25Ob3RpZmljYXRpb25Nb3VzZW91dCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLm9uTW91c2VvdmVyID09PSAncGF1c2VBdXRvSGlkZScpIHtcbiAgICAgIHRoaXMuY29udGludWVBdXRvSGlkZVRpbWVyKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5iZWhhdmlvdXIub25Nb3VzZW92ZXIgPT09ICdyZXNldEF1dG9IaWRlJykge1xuICAgICAgdGhpcy5zdGFydEF1dG9IaWRlVGltZXIoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGNsaWNrIG9uIG5vdGlmaWNhdGlvbiBhcmVhXG4gICAqL1xuICBwdWJsaWMgb25Ob3RpZmljYXRpb25DbGljaygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLm9uQ2xpY2sgPT09ICdoaWRlJykge1xuICAgICAgdGhpcy5vbkNsaWNrRGlzbWlzcygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgYXV0byBoaWRlIHRpbWVyIChpZiBlbmFibGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBzdGFydEF1dG9IaWRlVGltZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29uZmlnLmJlaGF2aW91ci5hdXRvSGlkZSAhPT0gZmFsc2UgJiYgdGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlID4gMCkge1xuICAgICAgdGhpcy50aW1lclNlcnZpY2Uuc3RhcnQodGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlKS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5vbkNsaWNrRGlzbWlzcygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhdXNlIHRoZSBhdXRvIGhpZGUgdGltZXIgKGlmIGVuYWJsZWQpXG4gICAqL1xuICBwcml2YXRlIHBhdXNlQXV0b0hpZGVUaW1lcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlICE9PSBmYWxzZSAmJiB0aGlzLmNvbmZpZy5iZWhhdmlvdXIuYXV0b0hpZGUgPiAwKSB7XG4gICAgICB0aGlzLnRpbWVyU2VydmljZS5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb250aW51ZSB0aGUgYXV0byBoaWRlIHRpbWVyIChpZiBlbmFibGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBjb250aW51ZUF1dG9IaWRlVGltZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29uZmlnLmJlaGF2aW91ci5hdXRvSGlkZSAhPT0gZmFsc2UgJiYgdGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlID4gMCkge1xuICAgICAgdGhpcy50aW1lclNlcnZpY2UuY29udGludWUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RvcCB0aGUgYXV0byBoaWRlIHRpbWVyIChpZiBlbmFibGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBzdG9wQXV0b0hpZGVUaW1lcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlICE9PSBmYWxzZSAmJiB0aGlzLmNvbmZpZy5iZWhhdmlvdXIuYXV0b0hpZGUgPiAwKSB7XG4gICAgICB0aGlzLnRpbWVyU2VydmljZS5zdG9wKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWwgbm90aWZpY2F0aW9uIHNldHVwXG4gICAqL1xuICBwcml2YXRlIHNldHVwKCk6IHZvaWQge1xuICAgIC8vIFNldCBzdGFydCBwb3NpdGlvbiAoaW5pdGlhbGx5IHRoZSBleGFjdCBzYW1lIGZvciBldmVyeSBuZXcgbm90aWZpY2F0aW9uKVxuICAgIGlmICh0aGlzLmNvbmZpZy5wb3NpdGlvbi5ob3Jpem9udGFsLnBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnbGVmdCcsIGAke3RoaXMuY29uZmlnLnBvc2l0aW9uLmhvcml6b250YWwuZGlzdGFuY2V9cHhgKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnBvc2l0aW9uLmhvcml6b250YWwucG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAncmlnaHQnLCBgJHt0aGlzLmNvbmZpZy5wb3NpdGlvbi5ob3Jpem9udGFsLmRpc3RhbmNlfXB4YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnbGVmdCcsICc1MCUnKTtcbiAgICAgIC8vIExldCdzIGdldCB0aGUgR1BVIGhhbmRsZSBzb21lIHdvcmsgYXMgd2VsbCAoI3BlcmZtYXR0ZXJzKVxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlM2QoIC01MCUsIDAsIDAgKScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwucG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3RvcCcsIGAke3RoaXMuY29uZmlnLnBvc2l0aW9uLnZlcnRpY2FsLmRpc3RhbmNlfXB4YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnYm90dG9tJywgYCR7dGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwuZGlzdGFuY2V9cHhgKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgY2xhc3NlcyAocmVzcG9uc2libGUgZm9yIHZpc3VhbCBkZXNpZ24pXG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQsIGBub3RpZmllcl9fbm90aWZpY2F0aW9uLS0ke3RoaXMubm90aWZpY2F0aW9uLnR5cGV9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQsIGBub3RpZmllcl9fbm90aWZpY2F0aW9uLS0ke3RoaXMuY29uZmlnLnRoZW1lfWApO1xuICB9XG59XG4iXX0=