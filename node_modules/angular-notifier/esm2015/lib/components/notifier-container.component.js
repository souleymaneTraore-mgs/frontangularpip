/**
 * @fileoverview added by tsickle
 * Generated from: lib/components/notifier-container.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component } from '@angular/core';
import { NotifierNotification } from '../models/notifier-notification.model';
import { NotifierService } from '../services/notifier.service';
import { NotifierQueueService } from '../services/notifier-queue.service';
/**
 * Notifier container component
 * ----------------------------
 * This component acts as a wrapper for all notification components; consequently, it is responsible for creating a new notification
 * component and removing an existing notification component. Being more precicely, it also handles side effects of those actions, such as
 * shifting or even completely removing other notifications as well. Overall, this components handles actions coming from the queue service
 * by subscribing to its action stream.
 *
 * Technical sidenote:
 * This component has to be used somewhere in an application to work; it will not inject and create itself automatically, primarily in order
 * to not break the Angular AoT compilation. Moreover, this component (and also the notification components) set their change detection
 * strategy onPush, which means that we handle change detection manually in order to get the best performance. (#perfmatters)
 */
export class NotifierContainerComponent {
    /**
     * Constructor
     *
     * @param {?} changeDetector       Change detector, used for manually triggering change detection runs
     * @param {?} notifierQueueService Notifier queue service
     * @param {?} notifierService      Notifier service
     */
    constructor(changeDetector, notifierQueueService, notifierService) {
        this.changeDetector = changeDetector;
        this.queueService = notifierQueueService;
        this.config = notifierService.getConfig();
        this.notifications = [];
        // Connects this component up to the action queue, then handle incoming actions
        this.queueServiceSubscription = this.queueService.actionStream.subscribe((/**
         * @param {?} action
         * @return {?}
         */
        (action) => {
            this.handleAction(action).then((/**
             * @return {?}
             */
            () => {
                this.queueService.continue();
            }));
        }));
    }
    /**
     * Component destroyment lifecycle hook, cleans up the observable subsciption
     * @return {?}
     */
    ngOnDestroy() {
        if (this.queueServiceSubscription) {
            this.queueServiceSubscription.unsubscribe();
        }
    }
    /**
     * Notification identifier, used as the ngFor trackby function
     *
     * @param {?} index        Index
     * @param {?} notification Notifier notification
     * @return {?} Notification ID as the unique identnfier
     */
    identifyNotification(index, notification) {
        return notification.id;
    }
    /**
     * Event handler, handles clicks on notification dismiss buttons
     *
     * @param {?} notificationId ID of the notification to dismiss
     * @return {?}
     */
    onNotificationDismiss(notificationId) {
        this.queueService.push({
            payload: notificationId,
            type: 'HIDE',
        });
    }
    /**
     * Event handler, handles notification ready events
     *
     * @param {?} notificationComponent Notification component reference
     * @return {?}
     */
    onNotificationReady(notificationComponent) {
        /** @type {?} */
        const currentNotification = this.notifications[this.notifications.length - 1];
        currentNotification.component = notificationComponent; // Save the new omponent reference
        this.continueHandleShowAction(currentNotification); // Continue with handling the show action
    }
    /**
     * Handle incoming actions by mapping action types to methods, and then running them
     *
     * @private
     * @param {?} action Action object
     * @return {?} Promise, resolved when done
     */
    handleAction(action) {
        switch (action.type // TODO: Maybe a map (actionType -> class method) is a cleaner solution here?
        ) {
            case 'SHOW':
                return this.handleShowAction(action);
            case 'HIDE':
                return this.handleHideAction(action);
            case 'HIDE_OLDEST':
                return this.handleHideOldestAction(action);
            case 'HIDE_NEWEST':
                return this.handleHideNewestAction(action);
            case 'HIDE_ALL':
                return this.handleHideAllAction();
            default:
                return new Promise((/**
                 * @param {?} resolve
                 * @return {?}
                 */
                (resolve) => {
                    resolve(); // Ignore unknown action types
                }));
        }
    }
    /**
     * Show a new notification
     *
     * We simply add the notification to the list, and then wait until its properly initialized / created / rendered.
     *
     * @private
     * @param {?} action Action object
     * @return {?} Promise, resolved when done
     */
    handleShowAction(action) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        (resolve) => {
            this.tempPromiseResolver = resolve; // Save the promise resolve function so that it can be called later on by another method
            this.addNotificationToList(new NotifierNotification(action.payload));
        }));
    }
    /**
     * Continue to show a new notification (after the notification components is initialized / created / rendered).
     *
     * If this is the first (and thus only) notification, we can simply show it. Otherwhise, if stacking is disabled (or a low value), we
     * switch out notifications, in particular we hide the existing one, and then show our new one. Yet, if stacking is enabled, we first
     * shift all older notifications, and then show our new notification. In addition, if there are too many notification on the screen,
     * we hide the oldest one first. Furthermore, if configured, animation overlapping is applied.
     *
     * @private
     * @param {?} notification New notification to show
     * @return {?}
     */
    continueHandleShowAction(notification) {
        // First (which means only one) notification in the list?
        /** @type {?} */
        const numberOfNotifications = this.notifications.length;
        if (numberOfNotifications === 1) {
            notification.component.show().then(this.tempPromiseResolver); // Done
        }
        else {
            /** @type {?} */
            const implicitStackingLimit = 2;
            // Stacking enabled? (stacking value below 2 means stacking is disabled)
            if (this.config.behaviour.stacking === false || this.config.behaviour.stacking < implicitStackingLimit) {
                this.notifications[0].component.hide().then((/**
                 * @return {?}
                 */
                () => {
                    this.removeNotificationFromList(this.notifications[0]);
                    notification.component.show().then(this.tempPromiseResolver); // Done
                }));
            }
            else {
                /** @type {?} */
                const stepPromises = [];
                // Are there now too many notifications?
                if (numberOfNotifications > this.config.behaviour.stacking) {
                    /** @type {?} */
                    const oldNotifications = this.notifications.slice(1, numberOfNotifications - 1);
                    // Are animations enabled?
                    if (this.config.animations.enabled) {
                        // Is animation overlap enabled?
                        if (this.config.animations.overlap !== false && this.config.animations.overlap > 0) {
                            stepPromises.push(this.notifications[0].component.hide());
                            setTimeout((/**
                             * @return {?}
                             */
                            () => {
                                stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), true));
                            }), this.config.animations.hide.speed - this.config.animations.overlap);
                            setTimeout((/**
                             * @return {?}
                             */
                            () => {
                                stepPromises.push(notification.component.show());
                            }), this.config.animations.hide.speed + this.config.animations.shift.speed - this.config.animations.overlap);
                        }
                        else {
                            stepPromises.push(new Promise((/**
                             * @param {?} resolve
                             * @return {?}
                             */
                            (resolve) => {
                                this.notifications[0].component.hide().then((/**
                                 * @return {?}
                                 */
                                () => {
                                    this.shiftNotifications(oldNotifications, notification.component.getHeight(), true).then((/**
                                     * @return {?}
                                     */
                                    () => {
                                        notification.component.show().then(resolve);
                                    }));
                                }));
                            })));
                        }
                    }
                    else {
                        stepPromises.push(this.notifications[0].component.hide());
                        stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), true));
                        stepPromises.push(notification.component.show());
                    }
                }
                else {
                    /** @type {?} */
                    const oldNotifications = this.notifications.slice(0, numberOfNotifications - 1);
                    // Are animations enabled?
                    if (this.config.animations.enabled) {
                        // Is animation overlap enabled?
                        if (this.config.animations.overlap !== false && this.config.animations.overlap > 0) {
                            stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), true));
                            setTimeout((/**
                             * @return {?}
                             */
                            () => {
                                stepPromises.push(notification.component.show());
                            }), this.config.animations.shift.speed - this.config.animations.overlap);
                        }
                        else {
                            stepPromises.push(new Promise((/**
                             * @param {?} resolve
                             * @return {?}
                             */
                            (resolve) => {
                                this.shiftNotifications(oldNotifications, notification.component.getHeight(), true).then((/**
                                 * @return {?}
                                 */
                                () => {
                                    notification.component.show().then(resolve);
                                }));
                            })));
                        }
                    }
                    else {
                        stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), true));
                        stepPromises.push(notification.component.show());
                    }
                }
                Promise.all(stepPromises).then((/**
                 * @return {?}
                 */
                () => {
                    if (numberOfNotifications > this.config.behaviour.stacking) {
                        this.removeNotificationFromList(this.notifications[0]);
                    }
                    this.tempPromiseResolver();
                })); // Done
            }
        }
    }
    /**
     * Hide an existing notification
     *
     * Fist, we skip everything if there are no notifications at all, or the given notification does not exist. Then, we hide the given
     * notification. If there exist older notifications, we then shift them around to fill the gap. Once both hiding the given notification
     * and shifting the older notificaitons is done, the given notification gets finally removed (from the DOM).
     *
     * @private
     * @param {?} action Action object, payload contains the notification ID
     * @return {?} Promise, resolved when done
     */
    handleHideAction(action) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        (resolve) => {
            /** @type {?} */
            const stepPromises = [];
            // Does the notification exist / are there even any notifications? (let's prevent accidential errors)
            /** @type {?} */
            const notification = this.findNotificationById(action.payload);
            if (notification === undefined) {
                resolve();
                return;
            }
            // Get older notifications
            /** @type {?} */
            const notificationIndex = this.findNotificationIndexById(action.payload);
            if (notificationIndex === undefined) {
                resolve();
                return;
            }
            /** @type {?} */
            const oldNotifications = this.notifications.slice(0, notificationIndex);
            // Do older notifications exist, and thus do we need to shift other notifications as a consequence?
            if (oldNotifications.length > 0) {
                // Are animations enabled?
                if (this.config.animations.enabled && this.config.animations.hide.speed > 0) {
                    // Is animation overlap enabled?
                    if (this.config.animations.overlap !== false && this.config.animations.overlap > 0) {
                        stepPromises.push(notification.component.hide());
                        setTimeout((/**
                         * @return {?}
                         */
                        () => {
                            stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), false));
                        }), this.config.animations.hide.speed - this.config.animations.overlap);
                    }
                    else {
                        notification.component.hide().then((/**
                         * @return {?}
                         */
                        () => {
                            stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), false));
                        }));
                    }
                }
                else {
                    stepPromises.push(notification.component.hide());
                    stepPromises.push(this.shiftNotifications(oldNotifications, notification.component.getHeight(), false));
                }
            }
            else {
                stepPromises.push(notification.component.hide());
            }
            // Wait until both hiding and shifting is done, then remove the notification from the list
            Promise.all(stepPromises).then((/**
             * @return {?}
             */
            () => {
                this.removeNotificationFromList(notification);
                resolve(); // Done
            }));
        }));
    }
    /**
     * Hide the oldest notification (bridge to handleHideAction)
     *
     * @private
     * @param {?} action Action object
     * @return {?} Promise, resolved when done
     */
    handleHideOldestAction(action) {
        // Are there any notifications? (prevent accidential errors)
        if (this.notifications.length === 0) {
            return new Promise((/**
             * @param {?} resolve
             * @return {?}
             */
            (resolve) => {
                resolve();
            })); // Done
        }
        else {
            action.payload = this.notifications[0].id;
            return this.handleHideAction(action);
        }
    }
    /**
     * Hide the newest notification (bridge to handleHideAction)
     *
     * @private
     * @param {?} action Action object
     * @return {?} Promise, resolved when done
     */
    handleHideNewestAction(action) {
        // Are there any notifications? (prevent accidential errors)
        if (this.notifications.length === 0) {
            return new Promise((/**
             * @param {?} resolve
             * @return {?}
             */
            (resolve) => {
                resolve();
            })); // Done
        }
        else {
            action.payload = this.notifications[this.notifications.length - 1].id;
            return this.handleHideAction(action);
        }
    }
    /**
     * Hide all notifications at once
     *
     * @private
     * @return {?} Promise, resolved when done
     */
    handleHideAllAction() {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        (resolve) => {
            // Are there any notifications? (prevent accidential errors)
            /** @type {?} */
            const numberOfNotifications = this.notifications.length;
            if (numberOfNotifications === 0) {
                resolve(); // Done
                return;
            }
            // Are animations enabled?
            if (this.config.animations.enabled &&
                this.config.animations.hide.speed > 0 &&
                this.config.animations.hide.offset !== false &&
                this.config.animations.hide.offset > 0) {
                for (let i = numberOfNotifications - 1; i >= 0; i--) {
                    /** @type {?} */
                    const animationOffset = this.config.position.vertical.position === 'top' ? numberOfNotifications - 1 : i;
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.notifications[i].component.hide().then((/**
                         * @return {?}
                         */
                        () => {
                            // Are we done here, was this the last notification to be hidden?
                            if ((this.config.position.vertical.position === 'top' && i === 0) ||
                                (this.config.position.vertical.position === 'bottom' && i === numberOfNotifications - 1)) {
                                this.removeAllNotificationsFromList();
                                resolve(); // Done
                            }
                        }));
                    }), this.config.animations.hide.offset * animationOffset);
                }
            }
            else {
                /** @type {?} */
                const stepPromises = [];
                for (let i = numberOfNotifications - 1; i >= 0; i--) {
                    stepPromises.push(this.notifications[i].component.hide());
                }
                Promise.all(stepPromises).then((/**
                 * @return {?}
                 */
                () => {
                    this.removeAllNotificationsFromList();
                    resolve(); // Done
                }));
            }
        }));
    }
    /**
     * Shift multiple notifications at once
     *
     * @private
     * @param {?} notifications List containing the notifications to be shifted
     * @param {?} distance      Distance to shift (in px)
     * @param {?} toMakePlace   Flag, defining in which direciton to shift
     * @return {?} Promise, resolved when done
     */
    shiftNotifications(notifications, distance, toMakePlace) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        (resolve) => {
            // Are there any notifications to shift?
            if (notifications.length === 0) {
                resolve();
                return;
            }
            /** @type {?} */
            const notificationPromises = [];
            for (let i = notifications.length - 1; i >= 0; i--) {
                notificationPromises.push(notifications[i].component.shift(distance, toMakePlace));
            }
            Promise.all(notificationPromises).then(resolve); // Done
        }));
    }
    /**
     * Add a new notification to the list of notifications (triggers change detection)
     *
     * @private
     * @param {?} notification Notification to add to the list of notifications
     * @return {?}
     */
    addNotificationToList(notification) {
        this.notifications.push(notification);
        this.changeDetector.markForCheck(); // Run change detection because the notification list changed
    }
    /**
     * Remove an existing notification from the list of notifications (triggers change detection)
     *
     * @private
     * @param {?} notification Notification to be removed from the list of notifications
     * @return {?}
     */
    removeNotificationFromList(notification) {
        this.notifications = this.notifications.filter((/**
         * @param {?} item
         * @return {?}
         */
        (item) => item.component !== notification.component));
        this.changeDetector.markForCheck(); // Run change detection because the notification list changed
    }
    /**
     * Remove all notifications from the list (triggers change detection)
     * @private
     * @return {?}
     */
    removeAllNotificationsFromList() {
        this.notifications = [];
        this.changeDetector.markForCheck(); // Run change detection because the notification list changed
    }
    /**
     * Helper: Find a notification in the notification list by a given notification ID
     *
     * @private
     * @param {?} notificationId Notification ID, used for finding notification
     * @return {?} Notification, undefined if not found
     */
    findNotificationById(notificationId) {
        return this.notifications.find((/**
         * @param {?} currentNotification
         * @return {?}
         */
        (currentNotification) => currentNotification.id === notificationId));
    }
    /**
     * Helper: Find a notification's index by a given notification ID
     *
     * @private
     * @param {?} notificationId Notification ID, used for finding a notification's index
     * @return {?} Notification index, undefined if not found
     */
    findNotificationIndexById(notificationId) {
        /** @type {?} */
        const notificationIndex = this.notifications.findIndex((/**
         * @param {?} currentNotification
         * @return {?}
         */
        (currentNotification) => currentNotification.id === notificationId));
        return notificationIndex !== -1 ? notificationIndex : undefined;
    }
}
NotifierContainerComponent.decorators = [
    { type: Component, args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                // (#perfmatters)
                host: {
                    class: 'notifier__container',
                },
                selector: 'notifier-container',
                template: "<ul>\n  <li class=\"notifier__container-list\" *ngFor=\"let notification of notifications; trackBy: identifyNotification\">\n    <notifier-notification [notification]=\"notification\" (ready)=\"onNotificationReady($event)\" (dismiss)=\"onNotificationDismiss($event)\">\n    </notifier-notification>\n  </li>\n</ul>\n"
            }] }
];
/** @nocollapse */
NotifierContainerComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: NotifierQueueService },
    { type: NotifierService }
];
if (false) {
    /**
     * List of currently somewhat active notifications
     * @type {?}
     */
    NotifierContainerComponent.prototype.notifications;
    /**
     * Change detector
     * @type {?}
     * @private
     */
    NotifierContainerComponent.prototype.changeDetector;
    /**
     * Notifier queue service
     * @type {?}
     * @private
     */
    NotifierContainerComponent.prototype.queueService;
    /**
     * Notifier configuration
     * @type {?}
     * @private
     */
    NotifierContainerComponent.prototype.config;
    /**
     * Queue service observable subscription (saved for cleanup)
     * @type {?}
     * @private
     */
    NotifierContainerComponent.prototype.queueServiceSubscription;
    /**
     * Promise resolve function reference, temporarily used while the notification child component gets created
     * @type {?}
     * @private
     */
    NotifierContainerComponent.prototype.tempPromiseResolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpZXItY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItbm90aWZpZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9ub3RpZmllci1jb250YWluZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUtqRyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0QsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7Ozs7Ozs7Ozs7O0FBd0IxRSxNQUFNLE9BQU8sMEJBQTBCOzs7Ozs7OztJQXNDckMsWUFBbUIsY0FBaUMsRUFBRSxvQkFBMEMsRUFBRSxlQUFnQztRQUNoSSxJQUFJLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztRQUNyQyxJQUFJLENBQUMsWUFBWSxHQUFHLG9CQUFvQixDQUFDO1FBQ3pDLElBQUksQ0FBQyxNQUFNLEdBQUcsZUFBZSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO1FBRXhCLCtFQUErRTtRQUMvRSxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsU0FBUzs7OztRQUFDLENBQUMsTUFBc0IsRUFBRSxFQUFFO1lBQ2xHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSTs7O1lBQUMsR0FBRyxFQUFFO2dCQUNsQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQy9CLENBQUMsRUFBQyxDQUFDO1FBQ0wsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUtNLFdBQVc7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SUFLL0MseURBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IE5vdGlmaWVyQWN0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL25vdGlmaWVyLWFjdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBOb3RpZmllckNvbmZpZyB9IGZyb20gJy4uL21vZGVscy9ub3RpZmllci1jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgTm90aWZpZXJOb3RpZmljYXRpb24gfSBmcm9tICcuLi9tb2RlbHMvbm90aWZpZXItbm90aWZpY2F0aW9uLm1vZGVsJztcbmltcG9ydCB7IE5vdGlmaWVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL25vdGlmaWVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgTm90aWZpZXJRdWV1ZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9ub3RpZmllci1xdWV1ZS5zZXJ2aWNlJztcbmltcG9ydCB7IE5vdGlmaWVyTm90aWZpY2F0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi9ub3RpZmllci1ub3RpZmljYXRpb24uY29tcG9uZW50JztcblxuLyoqXG4gKiBOb3RpZmllciBjb250YWluZXIgY29tcG9uZW50XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBUaGlzIGNvbXBvbmVudCBhY3RzIGFzIGEgd3JhcHBlciBmb3IgYWxsIG5vdGlmaWNhdGlvbiBjb21wb25lbnRzOyBjb25zZXF1ZW50bHksIGl0IGlzIHJlc3BvbnNpYmxlIGZvciBjcmVhdGluZyBhIG5ldyBub3RpZmljYXRpb25cbiAqIGNvbXBvbmVudCBhbmQgcmVtb3ZpbmcgYW4gZXhpc3Rpbmcgbm90aWZpY2F0aW9uIGNvbXBvbmVudC4gQmVpbmcgbW9yZSBwcmVjaWNlbHksIGl0IGFsc28gaGFuZGxlcyBzaWRlIGVmZmVjdHMgb2YgdGhvc2UgYWN0aW9ucywgc3VjaCBhc1xuICogc2hpZnRpbmcgb3IgZXZlbiBjb21wbGV0ZWx5IHJlbW92aW5nIG90aGVyIG5vdGlmaWNhdGlvbnMgYXMgd2VsbC4gT3ZlcmFsbCwgdGhpcyBjb21wb25lbnRzIGhhbmRsZXMgYWN0aW9ucyBjb21pbmcgZnJvbSB0aGUgcXVldWUgc2VydmljZVxuICogYnkgc3Vic2NyaWJpbmcgdG8gaXRzIGFjdGlvbiBzdHJlYW0uXG4gKlxuICogVGVjaG5pY2FsIHNpZGVub3RlOlxuICogVGhpcyBjb21wb25lbnQgaGFzIHRvIGJlIHVzZWQgc29tZXdoZXJlIGluIGFuIGFwcGxpY2F0aW9uIHRvIHdvcms7IGl0IHdpbGwgbm90IGluamVjdCBhbmQgY3JlYXRlIGl0c2VsZiBhdXRvbWF0aWNhbGx5LCBwcmltYXJpbHkgaW4gb3JkZXJcbiAqIHRvIG5vdCBicmVhayB0aGUgQW5ndWxhciBBb1QgY29tcGlsYXRpb24uIE1vcmVvdmVyLCB0aGlzIGNvbXBvbmVudCAoYW5kIGFsc28gdGhlIG5vdGlmaWNhdGlvbiBjb21wb25lbnRzKSBzZXQgdGhlaXIgY2hhbmdlIGRldGVjdGlvblxuICogc3RyYXRlZ3kgb25QdXNoLCB3aGljaCBtZWFucyB0aGF0IHdlIGhhbmRsZSBjaGFuZ2UgZGV0ZWN0aW9uIG1hbnVhbGx5IGluIG9yZGVyIHRvIGdldCB0aGUgYmVzdCBwZXJmb3JtYW5jZS4gKCNwZXJmbWF0dGVycylcbiAqL1xuQENvbXBvbmVudCh7XG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLCAvLyAoI3BlcmZtYXR0ZXJzKVxuICBob3N0OiB7XG4gICAgY2xhc3M6ICdub3RpZmllcl9fY29udGFpbmVyJyxcbiAgfSxcbiAgc2VsZWN0b3I6ICdub3RpZmllci1jb250YWluZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vbm90aWZpZXItY29udGFpbmVyLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgTm90aWZpZXJDb250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICAvKipcbiAgICogTGlzdCBvZiBjdXJyZW50bHkgc29tZXdoYXQgYWN0aXZlIG5vdGlmaWNhdGlvbnNcbiAgICovXG4gIHB1YmxpYyBub3RpZmljYXRpb25zOiBBcnJheTxOb3RpZmllck5vdGlmaWNhdGlvbj47XG5cbiAgLyoqXG4gICAqIENoYW5nZSBkZXRlY3RvclxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWY7XG5cbiAgLyoqXG4gICAqIE5vdGlmaWVyIHF1ZXVlIHNlcnZpY2VcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgcXVldWVTZXJ2aWNlOiBOb3RpZmllclF1ZXVlU2VydmljZTtcblxuICAvKipcbiAgICogTm90aWZpZXIgY29uZmlndXJhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBjb25maWc6IE5vdGlmaWVyQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBRdWV1ZSBzZXJ2aWNlIG9ic2VydmFibGUgc3Vic2NyaXB0aW9uIChzYXZlZCBmb3IgY2xlYW51cClcbiAgICovXG4gIHByaXZhdGUgcXVldWVTZXJ2aWNlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgLyoqXG4gICAqIFByb21pc2UgcmVzb2x2ZSBmdW5jdGlvbiByZWZlcmVuY2UsIHRlbXBvcmFyaWx5IHVzZWQgd2hpbGUgdGhlIG5vdGlmaWNhdGlvbiBjaGlsZCBjb21wb25lbnQgZ2V0cyBjcmVhdGVkXG4gICAqL1xuICBwcml2YXRlIHRlbXBQcm9taXNlUmVzb2x2ZXI6ICgpID0+IHZvaWQ7XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSBjaGFuZ2VEZXRlY3RvciAgICAgICBDaGFuZ2UgZGV0ZWN0b3IsIHVzZWQgZm9yIG1hbnVhbGx5IHRyaWdnZXJpbmcgY2hhbmdlIGRldGVjdGlvbiBydW5zXG4gICAqIEBwYXJhbSBub3RpZmllclF1ZXVlU2VydmljZSBOb3RpZmllciBxdWV1ZSBzZXJ2aWNlXG4gICAqIEBwYXJhbSBub3RpZmllclNlcnZpY2UgICAgICBOb3RpZmllciBzZXJ2aWNlXG4gICAqL1xuICBwdWJsaWMgY29uc3RydWN0b3IoY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmLCBub3RpZmllclF1ZXVlU2VydmljZTogTm90aWZpZXJRdWV1ZVNlcnZpY2UsIG5vdGlmaWVyU2VydmljZTogTm90aWZpZXJTZXJ2aWNlKSB7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvciA9IGNoYW5nZURldGVjdG9yO1xuICAgIHRoaXMucXVldWVTZXJ2aWNlID0gbm90aWZpZXJRdWV1ZVNlcnZpY2U7XG4gICAgdGhpcy5jb25maWcgPSBub3RpZmllclNlcnZpY2UuZ2V0Q29uZmlnKCk7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zID0gW107XG5cbiAgICAvLyBDb25uZWN0cyB0aGlzIGNvbXBvbmVudCB1cCB0byB0aGUgYWN0aW9uIHF1ZXVlLCB0aGVuIGhhbmRsZSBpbmNvbWluZyBhY3Rpb25zXG4gICAgdGhpcy5xdWV1ZVNlcnZpY2VTdWJzY3JpcHRpb24gPSB0aGlzLnF1ZXVlU2VydmljZS5hY3Rpb25TdHJlYW0uc3Vic2NyaWJlKChhY3Rpb246IE5vdGlmaWVyQWN0aW9uKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZUFjdGlvbihhY3Rpb24pLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLnF1ZXVlU2VydmljZS5jb250aW51ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcG9uZW50IGRlc3Ryb3ltZW50IGxpZmVjeWNsZSBob29rLCBjbGVhbnMgdXAgdGhlIG9ic2VydmFibGUgc3Vic2NpcHRpb25cbiAgICovXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5xdWV1ZVNlcnZpY2VTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMucXVldWVTZXJ2aWNlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE5vdGlmaWNhdGlvbiBpZGVudGlmaWVyLCB1c2VkIGFzIHRoZSBuZ0ZvciB0cmFja2J5IGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSAgIGluZGV4ICAgICAgICBJbmRleFxuICAgKiBAcGFyYW0gICBub3RpZmljYXRpb24gTm90aWZpZXIgbm90aWZpY2F0aW9uXG4gICAqIEByZXR1cm5zIE5vdGlmaWNhdGlvbiBJRCBhcyB0aGUgdW5pcXVlIGlkZW50bmZpZXJcbiAgICovXG4gIHB1YmxpYyBpZGVudGlmeU5vdGlmaWNhdGlvbihpbmRleDogbnVtYmVyLCBub3RpZmljYXRpb246IE5vdGlmaWVyTm90aWZpY2F0aW9uKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbm90aWZpY2F0aW9uLmlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEV2ZW50IGhhbmRsZXIsIGhhbmRsZXMgY2xpY2tzIG9uIG5vdGlmaWNhdGlvbiBkaXNtaXNzIGJ1dHRvbnNcbiAgICpcbiAgICogQHBhcmFtIG5vdGlmaWNhdGlvbklkIElEIG9mIHRoZSBub3RpZmljYXRpb24gdG8gZGlzbWlzc1xuICAgKi9cbiAgcHVibGljIG9uTm90aWZpY2F0aW9uRGlzbWlzcyhub3RpZmljYXRpb25JZDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5xdWV1ZVNlcnZpY2UucHVzaCh7XG4gICAgICBwYXlsb2FkOiBub3RpZmljYXRpb25JZCxcbiAgICAgIHR5cGU6ICdISURFJyxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFdmVudCBoYW5kbGVyLCBoYW5kbGVzIG5vdGlmaWNhdGlvbiByZWFkeSBldmVudHNcbiAgICpcbiAgICogQHBhcmFtIG5vdGlmaWNhdGlvbkNvbXBvbmVudCBOb3RpZmljYXRpb24gY29tcG9uZW50IHJlZmVyZW5jZVxuICAgKi9cbiAgcHVibGljIG9uTm90aWZpY2F0aW9uUmVhZHkobm90aWZpY2F0aW9uQ29tcG9uZW50OiBOb3RpZmllck5vdGlmaWNhdGlvbkNvbXBvbmVudCk6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnROb3RpZmljYXRpb246IE5vdGlmaWVyTm90aWZpY2F0aW9uID0gdGhpcy5ub3RpZmljYXRpb25zW3RoaXMubm90aWZpY2F0aW9ucy5sZW5ndGggLSAxXTsgLy8gR2V0IHRoZSBsYXRlc3Qgbm90aWZpY2F0aW9uXG4gICAgY3VycmVudE5vdGlmaWNhdGlvbi5jb21wb25lbnQgPSBub3RpZmljYXRpb25Db21wb25lbnQ7IC8vIFNhdmUgdGhlIG5ldyBvbXBvbmVudCByZWZlcmVuY2VcbiAgICB0aGlzLmNvbnRpbnVlSGFuZGxlU2hvd0FjdGlvbihjdXJyZW50Tm90aWZpY2F0aW9uKTsgLy8gQ29udGludWUgd2l0aCBoYW5kbGluZyB0aGUgc2hvdyBhY3Rpb25cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgaW5jb21pbmcgYWN0aW9ucyBieSBtYXBwaW5nIGFjdGlvbiB0eXBlcyB0byBtZXRob2RzLCBhbmQgdGhlbiBydW5uaW5nIHRoZW1cbiAgICpcbiAgICogQHBhcmFtICAgYWN0aW9uIEFjdGlvbiBvYmplY3RcbiAgICogQHJldHVybnMgUHJvbWlzZSwgcmVzb2x2ZWQgd2hlbiBkb25lXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUFjdGlvbihhY3Rpb246IE5vdGlmaWVyQWN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgc3dpdGNoIChcbiAgICAgIGFjdGlvbi50eXBlIC8vIFRPRE86IE1heWJlIGEgbWFwIChhY3Rpb25UeXBlIC0+IGNsYXNzIG1ldGhvZCkgaXMgYSBjbGVhbmVyIHNvbHV0aW9uIGhlcmU/XG4gICAgKSB7XG4gICAgICBjYXNlICdTSE9XJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlU2hvd0FjdGlvbihhY3Rpb24pO1xuICAgICAgY2FzZSAnSElERSc6XG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUhpZGVBY3Rpb24oYWN0aW9uKTtcbiAgICAgIGNhc2UgJ0hJREVfT0xERVNUJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlSGlkZU9sZGVzdEFjdGlvbihhY3Rpb24pO1xuICAgICAgY2FzZSAnSElERV9ORVdFU1QnOlxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVIaWRlTmV3ZXN0QWN0aW9uKGFjdGlvbik7XG4gICAgICBjYXNlICdISURFX0FMTCc6XG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUhpZGVBbGxBY3Rpb24oKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoKTsgLy8gSWdub3JlIHVua25vd24gYWN0aW9uIHR5cGVzXG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGEgbmV3IG5vdGlmaWNhdGlvblxuICAgKlxuICAgKiBXZSBzaW1wbHkgYWRkIHRoZSBub3RpZmljYXRpb24gdG8gdGhlIGxpc3QsIGFuZCB0aGVuIHdhaXQgdW50aWwgaXRzIHByb3Blcmx5IGluaXRpYWxpemVkIC8gY3JlYXRlZCAvIHJlbmRlcmVkLlxuICAgKlxuICAgKiBAcGFyYW0gICBhY3Rpb24gQWN0aW9uIG9iamVjdFxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHByaXZhdGUgaGFuZGxlU2hvd0FjdGlvbihhY3Rpb246IE5vdGlmaWVyQWN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlOiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgICB0aGlzLnRlbXBQcm9taXNlUmVzb2x2ZXIgPSByZXNvbHZlOyAvLyBTYXZlIHRoZSBwcm9taXNlIHJlc29sdmUgZnVuY3Rpb24gc28gdGhhdCBpdCBjYW4gYmUgY2FsbGVkIGxhdGVyIG9uIGJ5IGFub3RoZXIgbWV0aG9kXG4gICAgICB0aGlzLmFkZE5vdGlmaWNhdGlvblRvTGlzdChuZXcgTm90aWZpZXJOb3RpZmljYXRpb24oYWN0aW9uLnBheWxvYWQpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb250aW51ZSB0byBzaG93IGEgbmV3IG5vdGlmaWNhdGlvbiAoYWZ0ZXIgdGhlIG5vdGlmaWNhdGlvbiBjb21wb25lbnRzIGlzIGluaXRpYWxpemVkIC8gY3JlYXRlZCAvIHJlbmRlcmVkKS5cbiAgICpcbiAgICogSWYgdGhpcyBpcyB0aGUgZmlyc3QgKGFuZCB0aHVzIG9ubHkpIG5vdGlmaWNhdGlvbiwgd2UgY2FuIHNpbXBseSBzaG93IGl0LiBPdGhlcndoaXNlLCBpZiBzdGFja2luZyBpcyBkaXNhYmxlZCAob3IgYSBsb3cgdmFsdWUpLCB3ZVxuICAgKiBzd2l0Y2ggb3V0IG5vdGlmaWNhdGlvbnMsIGluIHBhcnRpY3VsYXIgd2UgaGlkZSB0aGUgZXhpc3Rpbmcgb25lLCBhbmQgdGhlbiBzaG93IG91ciBuZXcgb25lLiBZZXQsIGlmIHN0YWNraW5nIGlzIGVuYWJsZWQsIHdlIGZpcnN0XG4gICAqIHNoaWZ0IGFsbCBvbGRlciBub3RpZmljYXRpb25zLCBhbmQgdGhlbiBzaG93IG91ciBuZXcgbm90aWZpY2F0aW9uLiBJbiBhZGRpdGlvbiwgaWYgdGhlcmUgYXJlIHRvbyBtYW55IG5vdGlmaWNhdGlvbiBvbiB0aGUgc2NyZWVuLFxuICAgKiB3ZSBoaWRlIHRoZSBvbGRlc3Qgb25lIGZpcnN0LiBGdXJ0aGVybW9yZSwgaWYgY29uZmlndXJlZCwgYW5pbWF0aW9uIG92ZXJsYXBwaW5nIGlzIGFwcGxpZWQuXG4gICAqXG4gICAqIEBwYXJhbSBub3RpZmljYXRpb24gTmV3IG5vdGlmaWNhdGlvbiB0byBzaG93XG4gICAqL1xuICBwcml2YXRlIGNvbnRpbnVlSGFuZGxlU2hvd0FjdGlvbihub3RpZmljYXRpb246IE5vdGlmaWVyTm90aWZpY2F0aW9uKTogdm9pZCB7XG4gICAgLy8gRmlyc3QgKHdoaWNoIG1lYW5zIG9ubHkgb25lKSBub3RpZmljYXRpb24gaW4gdGhlIGxpc3Q/XG4gICAgY29uc3QgbnVtYmVyT2ZOb3RpZmljYXRpb25zOiBudW1iZXIgPSB0aGlzLm5vdGlmaWNhdGlvbnMubGVuZ3RoO1xuICAgIGlmIChudW1iZXJPZk5vdGlmaWNhdGlvbnMgPT09IDEpIHtcbiAgICAgIG5vdGlmaWNhdGlvbi5jb21wb25lbnQuc2hvdygpLnRoZW4odGhpcy50ZW1wUHJvbWlzZVJlc29sdmVyKTsgLy8gRG9uZVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpbXBsaWNpdFN0YWNraW5nTGltaXQgPSAyO1xuXG4gICAgICAvLyBTdGFja2luZyBlbmFibGVkPyAoc3RhY2tpbmcgdmFsdWUgYmVsb3cgMiBtZWFucyBzdGFja2luZyBpcyBkaXNhYmxlZClcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5iZWhhdmlvdXIuc3RhY2tpbmcgPT09IGZhbHNlIHx8IHRoaXMuY29uZmlnLmJlaGF2aW91ci5zdGFja2luZyA8IGltcGxpY2l0U3RhY2tpbmdMaW1pdCkge1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnNbMF0uY29tcG9uZW50LmhpZGUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlbW92ZU5vdGlmaWNhdGlvbkZyb21MaXN0KHRoaXMubm90aWZpY2F0aW9uc1swXSk7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLmNvbXBvbmVudC5zaG93KCkudGhlbih0aGlzLnRlbXBQcm9taXNlUmVzb2x2ZXIpOyAvLyBEb25lXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgc3RlcFByb21pc2VzOiBBcnJheTxQcm9taXNlPHZvaWQ+PiA9IFtdO1xuXG4gICAgICAgIC8vIEFyZSB0aGVyZSBub3cgdG9vIG1hbnkgbm90aWZpY2F0aW9ucz9cbiAgICAgICAgaWYgKG51bWJlck9mTm90aWZpY2F0aW9ucyA+IHRoaXMuY29uZmlnLmJlaGF2aW91ci5zdGFja2luZykge1xuICAgICAgICAgIGNvbnN0IG9sZE5vdGlmaWNhdGlvbnM6IEFycmF5PE5vdGlmaWVyTm90aWZpY2F0aW9uPiA9IHRoaXMubm90aWZpY2F0aW9ucy5zbGljZSgxLCBudW1iZXJPZk5vdGlmaWNhdGlvbnMgLSAxKTtcblxuICAgICAgICAgIC8vIEFyZSBhbmltYXRpb25zIGVuYWJsZWQ/XG4gICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuZW5hYmxlZCkge1xuICAgICAgICAgICAgLy8gSXMgYW5pbWF0aW9uIG92ZXJsYXAgZW5hYmxlZD9cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmltYXRpb25zLm92ZXJsYXAgIT09IGZhbHNlICYmIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMub3ZlcmxhcCA+IDApIHtcbiAgICAgICAgICAgICAgc3RlcFByb21pc2VzLnB1c2godGhpcy5ub3RpZmljYXRpb25zWzBdLmNvbXBvbmVudC5oaWRlKCkpO1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaCh0aGlzLnNoaWZ0Tm90aWZpY2F0aW9ucyhvbGROb3RpZmljYXRpb25zLCBub3RpZmljYXRpb24uY29tcG9uZW50LmdldEhlaWdodCgpLCB0cnVlKSk7XG4gICAgICAgICAgICAgIH0sIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuaGlkZS5zcGVlZCAtIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMub3ZlcmxhcCk7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKG5vdGlmaWNhdGlvbi5jb21wb25lbnQuc2hvdygpKTtcbiAgICAgICAgICAgICAgfSwgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5oaWRlLnNwZWVkICsgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5zaGlmdC5zcGVlZCAtIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMub3ZlcmxhcCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zWzBdLmNvbXBvbmVudC5oaWRlKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hpZnROb3RpZmljYXRpb25zKG9sZE5vdGlmaWNhdGlvbnMsIG5vdGlmaWNhdGlvbi5jb21wb25lbnQuZ2V0SGVpZ2h0KCksIHRydWUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jb21wb25lbnQuc2hvdygpLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKHRoaXMubm90aWZpY2F0aW9uc1swXS5jb21wb25lbnQuaGlkZSgpKTtcbiAgICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKHRoaXMuc2hpZnROb3RpZmljYXRpb25zKG9sZE5vdGlmaWNhdGlvbnMsIG5vdGlmaWNhdGlvbi5jb21wb25lbnQuZ2V0SGVpZ2h0KCksIHRydWUpKTtcbiAgICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKG5vdGlmaWNhdGlvbi5jb21wb25lbnQuc2hvdygpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3Qgb2xkTm90aWZpY2F0aW9uczogQXJyYXk8Tm90aWZpZXJOb3RpZmljYXRpb24+ID0gdGhpcy5ub3RpZmljYXRpb25zLnNsaWNlKDAsIG51bWJlck9mTm90aWZpY2F0aW9ucyAtIDEpO1xuXG4gICAgICAgICAgLy8gQXJlIGFuaW1hdGlvbnMgZW5hYmxlZD9cbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuYW5pbWF0aW9ucy5lbmFibGVkKSB7XG4gICAgICAgICAgICAvLyBJcyBhbmltYXRpb24gb3ZlcmxhcCBlbmFibGVkP1xuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbnMub3ZlcmxhcCAhPT0gZmFsc2UgJiYgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5vdmVybGFwID4gMCkge1xuICAgICAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaCh0aGlzLnNoaWZ0Tm90aWZpY2F0aW9ucyhvbGROb3RpZmljYXRpb25zLCBub3RpZmljYXRpb24uY29tcG9uZW50LmdldEhlaWdodCgpLCB0cnVlKSk7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKG5vdGlmaWNhdGlvbi5jb21wb25lbnQuc2hvdygpKTtcbiAgICAgICAgICAgICAgfSwgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5zaGlmdC5zcGVlZCAtIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMub3ZlcmxhcCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5zaGlmdE5vdGlmaWNhdGlvbnMob2xkTm90aWZpY2F0aW9ucywgbm90aWZpY2F0aW9uLmNvbXBvbmVudC5nZXRIZWlnaHQoKSwgdHJ1ZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jb21wb25lbnQuc2hvdygpLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RlcFByb21pc2VzLnB1c2godGhpcy5zaGlmdE5vdGlmaWNhdGlvbnMob2xkTm90aWZpY2F0aW9ucywgbm90aWZpY2F0aW9uLmNvbXBvbmVudC5nZXRIZWlnaHQoKSwgdHJ1ZSkpO1xuICAgICAgICAgICAgc3RlcFByb21pc2VzLnB1c2gobm90aWZpY2F0aW9uLmNvbXBvbmVudC5zaG93KCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIFByb21pc2UuYWxsKHN0ZXBQcm9taXNlcykudGhlbigoKSA9PiB7XG4gICAgICAgICAgaWYgKG51bWJlck9mTm90aWZpY2F0aW9ucyA+IHRoaXMuY29uZmlnLmJlaGF2aW91ci5zdGFja2luZykge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVOb3RpZmljYXRpb25Gcm9tTGlzdCh0aGlzLm5vdGlmaWNhdGlvbnNbMF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnRlbXBQcm9taXNlUmVzb2x2ZXIoKTtcbiAgICAgICAgfSk7IC8vIERvbmVcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGlkZSBhbiBleGlzdGluZyBub3RpZmljYXRpb25cbiAgICpcbiAgICogRmlzdCwgd2Ugc2tpcCBldmVyeXRoaW5nIGlmIHRoZXJlIGFyZSBubyBub3RpZmljYXRpb25zIGF0IGFsbCwgb3IgdGhlIGdpdmVuIG5vdGlmaWNhdGlvbiBkb2VzIG5vdCBleGlzdC4gVGhlbiwgd2UgaGlkZSB0aGUgZ2l2ZW5cbiAgICogbm90aWZpY2F0aW9uLiBJZiB0aGVyZSBleGlzdCBvbGRlciBub3RpZmljYXRpb25zLCB3ZSB0aGVuIHNoaWZ0IHRoZW0gYXJvdW5kIHRvIGZpbGwgdGhlIGdhcC4gT25jZSBib3RoIGhpZGluZyB0aGUgZ2l2ZW4gbm90aWZpY2F0aW9uXG4gICAqIGFuZCBzaGlmdGluZyB0aGUgb2xkZXIgbm90aWZpY2FpdG9ucyBpcyBkb25lLCB0aGUgZ2l2ZW4gbm90aWZpY2F0aW9uIGdldHMgZmluYWxseSByZW1vdmVkIChmcm9tIHRoZSBET00pLlxuICAgKlxuICAgKiBAcGFyYW0gICBhY3Rpb24gQWN0aW9uIG9iamVjdCwgcGF5bG9hZCBjb250YWlucyB0aGUgbm90aWZpY2F0aW9uIElEXG4gICAqIEByZXR1cm5zIFByb21pc2UsIHJlc29sdmVkIHdoZW4gZG9uZVxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVIaWRlQWN0aW9uKGFjdGlvbjogTm90aWZpZXJBY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmU6ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIGNvbnN0IHN0ZXBQcm9taXNlczogQXJyYXk8UHJvbWlzZTx2b2lkPj4gPSBbXTtcblxuICAgICAgLy8gRG9lcyB0aGUgbm90aWZpY2F0aW9uIGV4aXN0IC8gYXJlIHRoZXJlIGV2ZW4gYW55IG5vdGlmaWNhdGlvbnM/IChsZXQncyBwcmV2ZW50IGFjY2lkZW50aWFsIGVycm9ycylcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbjogTm90aWZpZXJOb3RpZmljYXRpb24gfCB1bmRlZmluZWQgPSB0aGlzLmZpbmROb3RpZmljYXRpb25CeUlkKGFjdGlvbi5wYXlsb2FkKTtcbiAgICAgIGlmIChub3RpZmljYXRpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IG9sZGVyIG5vdGlmaWNhdGlvbnNcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbkluZGV4OiBudW1iZXIgfCB1bmRlZmluZWQgPSB0aGlzLmZpbmROb3RpZmljYXRpb25JbmRleEJ5SWQoYWN0aW9uLnBheWxvYWQpO1xuICAgICAgaWYgKG5vdGlmaWNhdGlvbkluZGV4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBvbGROb3RpZmljYXRpb25zOiBBcnJheTxOb3RpZmllck5vdGlmaWNhdGlvbj4gPSB0aGlzLm5vdGlmaWNhdGlvbnMuc2xpY2UoMCwgbm90aWZpY2F0aW9uSW5kZXgpO1xuXG4gICAgICAvLyBEbyBvbGRlciBub3RpZmljYXRpb25zIGV4aXN0LCBhbmQgdGh1cyBkbyB3ZSBuZWVkIHRvIHNoaWZ0IG90aGVyIG5vdGlmaWNhdGlvbnMgYXMgYSBjb25zZXF1ZW5jZT9cbiAgICAgIGlmIChvbGROb3RpZmljYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gQXJlIGFuaW1hdGlvbnMgZW5hYmxlZD9cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuZW5hYmxlZCAmJiB0aGlzLmNvbmZpZy5hbmltYXRpb25zLmhpZGUuc3BlZWQgPiAwKSB7XG4gICAgICAgICAgLy8gSXMgYW5pbWF0aW9uIG92ZXJsYXAgZW5hYmxlZD9cbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuYW5pbWF0aW9ucy5vdmVybGFwICE9PSBmYWxzZSAmJiB0aGlzLmNvbmZpZy5hbmltYXRpb25zLm92ZXJsYXAgPiAwKSB7XG4gICAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaChub3RpZmljYXRpb24uY29tcG9uZW50LmhpZGUoKSk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgc3RlcFByb21pc2VzLnB1c2godGhpcy5zaGlmdE5vdGlmaWNhdGlvbnMob2xkTm90aWZpY2F0aW9ucywgbm90aWZpY2F0aW9uLmNvbXBvbmVudC5nZXRIZWlnaHQoKSwgZmFsc2UpKTtcbiAgICAgICAgICAgIH0sIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuaGlkZS5zcGVlZCAtIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMub3ZlcmxhcCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jb21wb25lbnQuaGlkZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaCh0aGlzLnNoaWZ0Tm90aWZpY2F0aW9ucyhvbGROb3RpZmljYXRpb25zLCBub3RpZmljYXRpb24uY29tcG9uZW50LmdldEhlaWdodCgpLCBmYWxzZSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKG5vdGlmaWNhdGlvbi5jb21wb25lbnQuaGlkZSgpKTtcbiAgICAgICAgICBzdGVwUHJvbWlzZXMucHVzaCh0aGlzLnNoaWZ0Tm90aWZpY2F0aW9ucyhvbGROb3RpZmljYXRpb25zLCBub3RpZmljYXRpb24uY29tcG9uZW50LmdldEhlaWdodCgpLCBmYWxzZSkpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGVwUHJvbWlzZXMucHVzaChub3RpZmljYXRpb24uY29tcG9uZW50LmhpZGUoKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFdhaXQgdW50aWwgYm90aCBoaWRpbmcgYW5kIHNoaWZ0aW5nIGlzIGRvbmUsIHRoZW4gcmVtb3ZlIHRoZSBub3RpZmljYXRpb24gZnJvbSB0aGUgbGlzdFxuICAgICAgUHJvbWlzZS5hbGwoc3RlcFByb21pc2VzKS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5yZW1vdmVOb3RpZmljYXRpb25Gcm9tTGlzdChub3RpZmljYXRpb24pO1xuICAgICAgICByZXNvbHZlKCk7IC8vIERvbmVcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgdGhlIG9sZGVzdCBub3RpZmljYXRpb24gKGJyaWRnZSB0byBoYW5kbGVIaWRlQWN0aW9uKVxuICAgKlxuICAgKiBAcGFyYW0gICBhY3Rpb24gQWN0aW9uIG9iamVjdFxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHByaXZhdGUgaGFuZGxlSGlkZU9sZGVzdEFjdGlvbihhY3Rpb246IE5vdGlmaWVyQWN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQXJlIHRoZXJlIGFueSBub3RpZmljYXRpb25zPyAocHJldmVudCBhY2NpZGVudGlhbCBlcnJvcnMpXG4gICAgaWYgKHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9KTsgLy8gRG9uZVxuICAgIH0gZWxzZSB7XG4gICAgICBhY3Rpb24ucGF5bG9hZCA9IHRoaXMubm90aWZpY2F0aW9uc1swXS5pZDtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUhpZGVBY3Rpb24oYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGlkZSB0aGUgbmV3ZXN0IG5vdGlmaWNhdGlvbiAoYnJpZGdlIHRvIGhhbmRsZUhpZGVBY3Rpb24pXG4gICAqXG4gICAqIEBwYXJhbSAgIGFjdGlvbiBBY3Rpb24gb2JqZWN0XG4gICAqIEByZXR1cm5zIFByb21pc2UsIHJlc29sdmVkIHdoZW4gZG9uZVxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVIaWRlTmV3ZXN0QWN0aW9uKGFjdGlvbjogTm90aWZpZXJBY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBBcmUgdGhlcmUgYW55IG5vdGlmaWNhdGlvbnM/IChwcmV2ZW50IGFjY2lkZW50aWFsIGVycm9ycylcbiAgICBpZiAodGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlOiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pOyAvLyBEb25lXG4gICAgfSBlbHNlIHtcbiAgICAgIGFjdGlvbi5wYXlsb2FkID0gdGhpcy5ub3RpZmljYXRpb25zW3RoaXMubm90aWZpY2F0aW9ucy5sZW5ndGggLSAxXS5pZDtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUhpZGVBY3Rpb24oYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGlkZSBhbGwgbm90aWZpY2F0aW9ucyBhdCBvbmNlXG4gICAqXG4gICAqIEByZXR1cm5zIFByb21pc2UsIHJlc29sdmVkIHdoZW4gZG9uZVxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVIaWRlQWxsQWN0aW9uKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgLy8gQXJlIHRoZXJlIGFueSBub3RpZmljYXRpb25zPyAocHJldmVudCBhY2NpZGVudGlhbCBlcnJvcnMpXG4gICAgICBjb25zdCBudW1iZXJPZk5vdGlmaWNhdGlvbnM6IG51bWJlciA9IHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGg7XG4gICAgICBpZiAobnVtYmVyT2ZOb3RpZmljYXRpb25zID09PSAwKSB7XG4gICAgICAgIHJlc29sdmUoKTsgLy8gRG9uZVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEFyZSBhbmltYXRpb25zIGVuYWJsZWQ/XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuZW5hYmxlZCAmJlxuICAgICAgICB0aGlzLmNvbmZpZy5hbmltYXRpb25zLmhpZGUuc3BlZWQgPiAwICYmXG4gICAgICAgIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuaGlkZS5vZmZzZXQgIT09IGZhbHNlICYmXG4gICAgICAgIHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuaGlkZS5vZmZzZXQgPiAwXG4gICAgICApIHtcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gbnVtYmVyT2ZOb3RpZmljYXRpb25zIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICBjb25zdCBhbmltYXRpb25PZmZzZXQ6IG51bWJlciA9IHRoaXMuY29uZmlnLnBvc2l0aW9uLnZlcnRpY2FsLnBvc2l0aW9uID09PSAndG9wJyA/IG51bWJlck9mTm90aWZpY2F0aW9ucyAtIDEgOiBpO1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zW2ldLmNvbXBvbmVudC5oaWRlKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIC8vIEFyZSB3ZSBkb25lIGhlcmUsIHdhcyB0aGlzIHRoZSBsYXN0IG5vdGlmaWNhdGlvbiB0byBiZSBoaWRkZW4/XG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAodGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwucG9zaXRpb24gPT09ICd0b3AnICYmIGkgPT09IDApIHx8XG4gICAgICAgICAgICAgICAgKHRoaXMuY29uZmlnLnBvc2l0aW9uLnZlcnRpY2FsLnBvc2l0aW9uID09PSAnYm90dG9tJyAmJiBpID09PSBudW1iZXJPZk5vdGlmaWNhdGlvbnMgLSAxKVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUFsbE5vdGlmaWNhdGlvbnNGcm9tTGlzdCgpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTsgLy8gRG9uZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCB0aGlzLmNvbmZpZy5hbmltYXRpb25zLmhpZGUub2Zmc2V0ICogYW5pbWF0aW9uT2Zmc2V0KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgc3RlcFByb21pc2VzOiBBcnJheTxQcm9taXNlPHZvaWQ+PiA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSBudW1iZXJPZk5vdGlmaWNhdGlvbnMgLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIHN0ZXBQcm9taXNlcy5wdXNoKHRoaXMubm90aWZpY2F0aW9uc1tpXS5jb21wb25lbnQuaGlkZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBQcm9taXNlLmFsbChzdGVwUHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMucmVtb3ZlQWxsTm90aWZpY2F0aW9uc0Zyb21MaXN0KCk7XG4gICAgICAgICAgcmVzb2x2ZSgpOyAvLyBEb25lXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNoaWZ0IG11bHRpcGxlIG5vdGlmaWNhdGlvbnMgYXQgb25jZVxuICAgKlxuICAgKiBAcGFyYW0gICBub3RpZmljYXRpb25zIExpc3QgY29udGFpbmluZyB0aGUgbm90aWZpY2F0aW9ucyB0byBiZSBzaGlmdGVkXG4gICAqIEBwYXJhbSAgIGRpc3RhbmNlICAgICAgRGlzdGFuY2UgdG8gc2hpZnQgKGluIHB4KVxuICAgKiBAcGFyYW0gICB0b01ha2VQbGFjZSAgIEZsYWcsIGRlZmluaW5nIGluIHdoaWNoIGRpcmVjaXRvbiB0byBzaGlmdFxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHByaXZhdGUgc2hpZnROb3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnM6IEFycmF5PE5vdGlmaWVyTm90aWZpY2F0aW9uPiwgZGlzdGFuY2U6IG51bWJlciwgdG9NYWtlUGxhY2U6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmU6ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIC8vIEFyZSB0aGVyZSBhbnkgbm90aWZpY2F0aW9ucyB0byBzaGlmdD9cbiAgICAgIGlmIChub3RpZmljYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uUHJvbWlzZXM6IEFycmF5PFByb21pc2U8dm9pZD4+ID0gW107XG4gICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSBub3RpZmljYXRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIG5vdGlmaWNhdGlvblByb21pc2VzLnB1c2gobm90aWZpY2F0aW9uc1tpXS5jb21wb25lbnQuc2hpZnQoZGlzdGFuY2UsIHRvTWFrZVBsYWNlKSk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLmFsbChub3RpZmljYXRpb25Qcm9taXNlcykudGhlbihyZXNvbHZlKTsgLy8gRG9uZVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyBub3RpZmljYXRpb24gdG8gdGhlIGxpc3Qgb2Ygbm90aWZpY2F0aW9ucyAodHJpZ2dlcnMgY2hhbmdlIGRldGVjdGlvbilcbiAgICpcbiAgICogQHBhcmFtIG5vdGlmaWNhdGlvbiBOb3RpZmljYXRpb24gdG8gYWRkIHRvIHRoZSBsaXN0IG9mIG5vdGlmaWNhdGlvbnNcbiAgICovXG4gIHByaXZhdGUgYWRkTm90aWZpY2F0aW9uVG9MaXN0KG5vdGlmaWNhdGlvbjogTm90aWZpZXJOb3RpZmljYXRpb24pOiB2b2lkIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnMucHVzaChub3RpZmljYXRpb24pO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IubWFya0ZvckNoZWNrKCk7IC8vIFJ1biBjaGFuZ2UgZGV0ZWN0aW9uIGJlY2F1c2UgdGhlIG5vdGlmaWNhdGlvbiBsaXN0IGNoYW5nZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYW4gZXhpc3Rpbmcgbm90aWZpY2F0aW9uIGZyb20gdGhlIGxpc3Qgb2Ygbm90aWZpY2F0aW9ucyAodHJpZ2dlcnMgY2hhbmdlIGRldGVjdGlvbilcbiAgICpcbiAgICogQHBhcmFtIG5vdGlmaWNhdGlvbiBOb3RpZmljYXRpb24gdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBsaXN0IG9mIG5vdGlmaWNhdGlvbnNcbiAgICovXG4gIHByaXZhdGUgcmVtb3ZlTm90aWZpY2F0aW9uRnJvbUxpc3Qobm90aWZpY2F0aW9uOiBOb3RpZmllck5vdGlmaWNhdGlvbik6IHZvaWQge1xuICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIoKGl0ZW06IE5vdGlmaWVyTm90aWZpY2F0aW9uKSA9PiBpdGVtLmNvbXBvbmVudCAhPT0gbm90aWZpY2F0aW9uLmNvbXBvbmVudCk7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5tYXJrRm9yQ2hlY2soKTsgLy8gUnVuIGNoYW5nZSBkZXRlY3Rpb24gYmVjYXVzZSB0aGUgbm90aWZpY2F0aW9uIGxpc3QgY2hhbmdlZFxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbGwgbm90aWZpY2F0aW9ucyBmcm9tIHRoZSBsaXN0ICh0cmlnZ2VycyBjaGFuZ2UgZGV0ZWN0aW9uKVxuICAgKi9cbiAgcHJpdmF0ZSByZW1vdmVBbGxOb3RpZmljYXRpb25zRnJvbUxpc3QoKTogdm9pZCB7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zID0gW107XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5tYXJrRm9yQ2hlY2soKTsgLy8gUnVuIGNoYW5nZSBkZXRlY3Rpb24gYmVjYXVzZSB0aGUgbm90aWZpY2F0aW9uIGxpc3QgY2hhbmdlZFxuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlcjogRmluZCBhIG5vdGlmaWNhdGlvbiBpbiB0aGUgbm90aWZpY2F0aW9uIGxpc3QgYnkgYSBnaXZlbiBub3RpZmljYXRpb24gSURcbiAgICpcbiAgICogQHBhcmFtICAgbm90aWZpY2F0aW9uSWQgTm90aWZpY2F0aW9uIElELCB1c2VkIGZvciBmaW5kaW5nIG5vdGlmaWNhdGlvblxuICAgKiBAcmV0dXJucyBOb3RpZmljYXRpb24sIHVuZGVmaW5lZCBpZiBub3QgZm91bmRcbiAgICovXG4gIHByaXZhdGUgZmluZE5vdGlmaWNhdGlvbkJ5SWQobm90aWZpY2F0aW9uSWQ6IHN0cmluZyk6IE5vdGlmaWVyTm90aWZpY2F0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zLmZpbmQoKGN1cnJlbnROb3RpZmljYXRpb246IE5vdGlmaWVyTm90aWZpY2F0aW9uKSA9PiBjdXJyZW50Tm90aWZpY2F0aW9uLmlkID09PSBub3RpZmljYXRpb25JZCk7XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyOiBGaW5kIGEgbm90aWZpY2F0aW9uJ3MgaW5kZXggYnkgYSBnaXZlbiBub3RpZmljYXRpb24gSURcbiAgICpcbiAgICogQHBhcmFtICAgbm90aWZpY2F0aW9uSWQgTm90aWZpY2F0aW9uIElELCB1c2VkIGZvciBmaW5kaW5nIGEgbm90aWZpY2F0aW9uJ3MgaW5kZXhcbiAgICogQHJldHVybnMgTm90aWZpY2F0aW9uIGluZGV4LCB1bmRlZmluZWQgaWYgbm90IGZvdW5kXG4gICAqL1xuICBwcml2YXRlIGZpbmROb3RpZmljYXRpb25JbmRleEJ5SWQobm90aWZpY2F0aW9uSWQ6IHN0cmluZyk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uSW5kZXg6IG51bWJlciA9IHRoaXMubm90aWZpY2F0aW9ucy5maW5kSW5kZXgoXG4gICAgICAoY3VycmVudE5vdGlmaWNhdGlvbjogTm90aWZpZXJOb3RpZmljYXRpb24pID0+IGN1cnJlbnROb3RpZmljYXRpb24uaWQgPT09IG5vdGlmaWNhdGlvbklkLFxuICAgICk7XG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvbkluZGV4ICE9PSAtMSA/IG5vdGlmaWNhdGlvbkluZGV4IDogdW5kZWZpbmVkO1xuICB9XG59XG4iXX0=